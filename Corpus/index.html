<!DOCTYPE html>
<html>
        <header>
                <title>CO600 Corpus Material</title>
                <h1 id="title">CO600 Corpus Material</h1>
        
        
                <link rel="stylesheet" href="main.css">
        
            </header>

<body>

    
    <div id="navTable">
        <table id="t01" align="center">
            <tr>
                <td>Project title</td>
                <td> EchoBook (Echo Parakeet tracking system in Mauritius)</td>
            </tr>
            <tr>
                <td>Group members</td>
                <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem, Elina Voitane</td>
            </tr>
            <tr>
                <td>Supervisor</td>
                <td>Daniel Knox</td>
            </tr>

        </table>
        <br>

        <table id="t02" align="center">

            <tr>
                <th>No.</th>
                <th>Document title</th>
                <th>Author(s)</th>
                <th>Best Work</th>
            </tr>

            <tr>
                <th colspan="4"> Phase 1 Research</th>
            </tr>

            <tr>
                <td> 1.1 </td>
                <td><a href="#hardwareChoices"> Hardware Decisions</a></td>
                <td> Karlis Jaunslavietis, Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>

            <tr>
                <td> 1.2 </td>
                <td><a href="#softwareChoices"> Software Decisions</a></td>
                <td> Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem, Elina Voitane</td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 2 Requirements </th>
            </tr>

            <tr>
                <td> 2.1 </td>
                <td><a href="#users"> Understanding the user </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>
            <tr>
                <td> 2.2 </td>
                <td><a href="#stories"> User Stories </a></td>
                <td> Karlis Jaunslavietis, Elina Voitane, Priyesh Patel, Afzaal Ahmad Razeem</td>
                <td></td>
            </tr>
            <tr>
                <td> 2.3 </td>
                <td><a href="#usecases"> Use Case Descriptions </a></td>
                <td> Karlis Jaunslavietis, Elina Voitane, Priyesh Patel, Afzaal Ahmad Razeem</td>
                <td></td>
            </tr>
            <tr>
                <td> 2.4 </td>
                <td><a href="#reqdoc"> Requirements Document </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <th colspan="4"> Phase 3 System Design </th>
            </tr>
            <tr>
                <td> 3.1 </td>
                <td><a href="#datadi"> Database Diagram </a></td>
                <td> Priyesh Patel, Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>
            <tr>
                <td> 3.2 </td>
                <td><a href="#netdi"> Network Diagram </a></td>
                <td> Elina Voitane, Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 3.3 </td>
                <td><a href="#sysdi"> System Diagram </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 4 UI Design </th>
            </tr>

            <tr>
                <td> 4.1 </td>
                <td><a href="#lofi1"> Lo-Fi Design 1 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>


            <tr>
                <td> 4.2 </td>
                <td><a href="#lofi2"> Lo-Fi Design 2 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <td> 4.3 </td>
                <td><a href="#hifi1"> Hi-Fi Design 1 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <td> 4.4 </td>
                <td><a href="#hifi2"> Hi-Fi Design 2 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 5 Development </th>
            </tr>
            <tr>
                <td colspan="4"> Development did not follow an ordered structure as the above phases (components were
                    started, "finished" and updated throughout as expected in a user-centred system), so instead this
                    section will just be split by system components. In
                    cases of components being worked on by multiple people, the actual work contributed by each member
                    will be discussed in it's section.
                </td>
            </tr>
            <tr>
                <td> 5.1 </td>
                <td><a href="#scripts">Coordinator Service</a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.2 </td>
                <td><a href="#datamodel"> Database / Models </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.3 </td>
                <td><a href="#css"> CSS Styling & Matching UI Design </a></td>
                <td> Priyesh Patel, Afzaal Ahmad Razeem, Karlis Jaunslavietis</td>
                <td></td>
            </tr>
            <tr>
                <td> 5.4 </td>
                <td><a href="#log"> Login/Logout </a></td>
                <td> Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.5 </td>
                <td><a href="#live"> Live View </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.6 </td>
                <td><a href="#bird"> Bird View </a></td>
                <td> Afzaal Ahmad Razeem / Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.7 </td>
                <td><a href="#export"> Bird Data Export </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.8 </td>
                <td><a href="#ring"> Ring Management </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.9 </td>
                <td><a href="#nest"> Nest Management </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.10 </td>
                <td><a href="#user"> User Management </a></td>
                <td> Karlis Jaunslavietis / Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.11 </td>
                <td><a href="#useract"> User Activity Monitoring </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.12 </td>
                <td><a href="#over"> Account Overview </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.13 </td>
                <td><a href="#utils"> Utilities </a></td>
                <td> Karlis Jaunslavietis, Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <th colspan="4"> Phase 6 Development Documentation </th>
            </tr>
            <tr>
                <td> 6.1 </td>
                <td><a href="Phase6/UserManual.pdf" target="_blank"> User Manual </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <th colspan="4"> Module Deliverables </th>
            </tr>
            <tr>
            <tr>
                <td>D1</td>
                <td><a href="ModuleDeliverables/AbstractFinal.pdf" target="_blank"> Abstract </a></td>
                <td>Elina Voitane</td>
                <td></td>
            </tr>
            <tr>
                <td>D2</td>
                <td><a href="ModuleDeliverables/PosterFinal.pdf" target="_blank"> Poster </a></td>
                <td>Elina Voitane</td>
                <td></td>
            </tr>
            <tr>
                <td>D3</td>
                <td> <a href="#">Technical Report</a></td>
                <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem, Elina Voitane</td>
                <td></td>
            </tr>
            <tr>
                <td>D4</td>
                <td><a href="ModuleDeliverables/SourceCode.zip" download>Source Code</a> </td>
                <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem</td>
                <td></td>
            </tr>
            <tr>
                <td>D5</td>
                <td><a href="ModuleDeliverables/VideoFinal.mp4" download>System Video - (if on chrome, right click and save as to download)</a> </td>
                <td>Priyesh Patel</td>
                <td></td>
            </tr>
            <tr>
                <th colspan="4"> Miscellaneous </th>
            </tr>
            <tr>
                <td>M1</td>
                <td><a href="Miscellaneous/Meeting%20Minutes%20Combined.pdf" target="_blank"> Meeting Minutes </a></td>
                <td>Elina Voitane</td>
                <td></td>
            </tr>
            <tr>
                <td>M2</td>
                <td><a href="Miscellaneous/Project%20Plan.pdf" target="_blank"> Project Plan </a></td>
                <td>Elina Voitane</td>
                <td></td>
            </tr>
        </table>
    </div>

    <div id="hardwareChoices">
        <h2 id="hardwareChoices"> 1.1 Hardware Decisions <a class="bu" href="#">Back to Top </a></h2>
        <h3>1.1.1 Network technology</h3>
            We chose to use a wireless network because the customer didn't want to have exposed cables running around the site, and digging trenches for the cables
            was deemed infeasible. Given the limited power available on site, we had to choose a low-power wireless network technology to carry RFID data from the reader
            to the server where it would then be stored in a database. Based on the amount of documentation and support available, we found the three most popular low-power wireless technologies to be Bluetooth Low Energy (BLE),
            ZigBee and Long Range Wide Area Network (LoraWAN).
            <table id="t03" align="center">

                <tr>
                    <td>BLE</td>
                    <td>ZigBee</td>
                    <td>LoraWAN</td>
                </tr>

                <tr>
                    <td id="tableinfo">
                        <ul>
                            <li>BLE is low power</li>
                            <li>It is cheap</li>
                            <li>Data rate is 1mb/s</li>
                            <li>Range 50-150 metres</li>
                            <li>BLE does not officially offer mesh network*</li>
                        </ul>

                        <p>* Few BLE solutions do offer mesh network (Nordic, Qualcomm)</p>
                        <br>
                        <p>BLE supported hardware on Mbed</p>
                        <ul>
                            <li>Nordic development board</li>
                            <li>Seeed Arch BLE</li>
                        </ul>
                    </td>

                    <td id="tableinfo">
                        <ul>
                            <li>Used in mesh network designed to carry small amounts of data across medium distances</li>
                            <li>Low power (more than BLE)</li>
                            <li>Data rate is 250 kb/s</li>
                            <li>Range 10-100 metres</li>
                            <li>Official Mbed library</li>
                        </ul>
                    </td>

                    <td id="tableinfo">
                        <ul>
                            <li>Data rate is 0.3 - 50 kb/s</li>
                            <li>Range 2-3km (urban environment)</li>
                            <li>Power consumption lower than ZigBee</li>

                        </ul>
                    </td>

                </tr>

            </table>
        <br>
        <p>BLE is a radio protocol meant for PAN<i>(Personal Area Network)</i>. Good for devices that stay in close proximity to each other. It is not ideal for devices that are separated by more 
            than a few meters away from each other, so it not suitable for our project. LoraWAN on the other hand, is a really long range protocol but it has a very 
            low data transfer rate, which will not be suitable for our project. Zigbee is a better option for the purpose of this project. It is a mid range protocol with higher data transfer rate than LoraWAN.
            Considering ZigBee's almost instant network join time it is more suitable for our project needs as well as its support for large-scale automation purposes. The trade-off that had to be considered was ZigBee's higher power
            consumption, however,given our project scenario, this trade-off can be afforded.<br><br>
            <p class="todo">TODO: take a second look at the above paragraph</p>
            ZigBee devices can operate in two modes: <i>AT</i> and <i>API</i>.
            In AT mode, only raw data is passed between ZigBee devices; the receiving device receives exactly the data that the sending device sent, without any additional padding or meta-data.
            In API mode, all messages sent between the ZigBee devices are constructed as packets that contain various other information and/or instructions. AT mode can only be used for sending raw data in one direction
            (eg. without expecting any response), whereas in API mode the devices can pass commands between each other that can solicit a response, status information, etc. Despite the extra features offered by API mode,
            we chose to use AT mode, as using it in API mode would require it to be connected to a microcontroller to use its processor, whereas in AT mode we could connect the RFID reader to the ZigBee directly without
            having to process the data with a middle-device. This choice significantly decreased the complexity of our system design as well as the power consumption of the individual reader nodes, at the expense of some extra functionality,
            such as the ability to automatically detect when a ZigBee device goes offline. 
            <br><br>
            Three ZigBee-compliant radio modules (Digi XBee) were given to us by our supervisor for development and testing purposes. One is used as the network 'coordinator'; in a ZigBee network the coordinator is responsible for creating and maintaining the
            network and administrating other devices joining the network. Our system also uses the coordinator as the receiver of all data; it is connected via serial to the server (described in sections 1.1.4 and 5.1), which reads the incoming data and stores
            it in the database.
            <p class="todo">TODO: check with Dan that they're actually XBees</p>
                </p>
        <h3>1.1.2 RFID techonology</h3>
        <p>
            When choosing the RFID hardware, we aimed for the following:
            <ol>
                <li>
                    The antenna embedded in the bird ring should not require an internal power source - adding a battery to the bird ring was deemed infeasible
                </li>
                <li>
                    The read distance (maximum range between the RFID antenna and reader where the reader can receive data from the antenna) should be maximized to avoid missing bird visits
                </li>
                <li>
                    The RFID signal should be able to pass through minor obstacles, such as a protective case, as well as dust, grime
                </li>
                <li>
                    The RFID antenna should be small enough to fit in a ring
                </li>
            </ol>
            RFID devices are generally grouped by their frequency:
            <ul>
                <li>Low Frequency (125 - 134 KHz)</li>
                <li>High Frequency (13.56 MHz)</li>
                <li>Ultra High Frequency (433, 860-960 MHz)</li>
            </ul>
            Following the laws of physics, the higher the frequency, the lower the wavelength, thus, the read distance increases with frequency.  As frequency decreases, the wavelength increases, and high wavelengths are essential for waves to penetrate objects. This makes lower frequencies more reliable, despite the trade-off in read distance.<br><br>

            Aside from the frequency, the other defining characteristic for RFID systems is the way the tag is powered. Active tags require an internal power source, most commonly a battery. Passive tags, meanwhile, use the radio waves generated by the reader to power their internal circuits. This means that the reading distance for passive tags is much lower than for active tags, as the waves powering the tag lose power over distance. As an active tag would eventually need to have its batteries recharged (thus requiring the team to capture the bird, remove the ring, recharge and reattach it), in this use case a passive RFID system was deemed to be most fitting.<br><br>
            
            With these two factors in mind, we opted to use a 134.2 KHz RFID reader and tags. The read distance (~2 cm) was determined to be suitable for the use case, as the reader can be positioned in such a way that it is guaranteed to register a visit once the bird accesses the food stored in the hopper.
            The specific devices we used for development and testing were recommended and purchased by our supervisor. They are ISO 11784/11785 ("Radio Frequency Identification of Animals") compliant, which means that there is standardized documentation available and a different ISO-compliant vendor can be used in the future, if required.
            The size of the antenna is 1.25mm x 7mm, which can comfortably fit into a bird ring.
            <p class="todo">TODO: pictures of the tag and reader</p>
        </p>
        <h3>1.1.3 Power Solution</h3>
        <p>
            On the customer's site, solar power is used for nearly all purposes. Although they have a generator, it would be infeasible to use the generator to power our system. Therefore, it was decided that our system should make use of the solar power
            available on site, in order to integrate better with their existing processes and minimize any physical transformations required.<br><br>
            The location of the customer's site generally has a good level of solar power throughout the day. However, relying solely on the incoming sun rays would make the system in-operable at night or when it was cloudier than usual. Therefore,
            we opted to use a battery that would be charged by solar power during the day, and would last long enough to overcome extended periods of darkness.<br><br>
            With the help of our supervisor, we calculated the optimal solar panel size and battery capacity. Each feeder with a RFID reader would have its own solar panel and battery; the server would use a battery that is connected to the existing solar
            panels they have on site. The devices, seen in the picture below, were then purchased by our supervisor.
            <p class="todo">TODO: pictures of solar panel and battery, also find out from Dan the exact panel size and battery capacity</p>
        </p>
        <h3>1.1.4 The server</h3>
        <p>
            The server hosting the core of the system (database, application, coordinator service) must meet the following basic requirements:
            <ul>
                <li>
                    Be able to run a standard operating system (Windows / Linux)
                </li>
                <li>
                    Have a user interface that can be used by non-technical users for common tasks, such as restarting the system
                </li>
                <li>
                    Have a serial port for the coordinator
                </li>
            </ul>
            As most modern servers fit the requirements outlined above, we avoided committing to a specific product, instead deferring the decision to when the system will enter its deployment stage. A Raspberry PI is currently viewed
            as one of the most likely products due to its performance/power consumption balance, high portability and low cost.
        </p>
    </div>
    <div id="softwareChoices">
        <h2> 1.2 Software Decisions <a class="bu" href="#">Back to Top </a></h2>
        
        <h3> Software for UI design</h3>
        
        <li>myBalsamiq</li>
        <p>The first UI design was done using myBalsamiq tool. It was used to get rough sketches and mock up ideas to visualise what needs to be included in the system. The most important task when designing UI for our system was to decide how to display bird's data which included work with different sets of mock data. myBalsamiq tool turned to be too Lo-Fi for expected results so it was decided to use Google Slides instead to continue working on system's UI design.</p>
        <li>Google Slides</li>
        <p>Google Slides turned to be the most optimal software choice for system's UI designed. Real time editing and collaboration features allowed us to view and edit different parts of UI at the same time. This software provided us with all the necessary tools to create Hi-Fi UI prototypes and use them to run usability test with the client. Throughout the project we used Google Drive as a main tool to create and store all documents related to the project which is also why Google Slides was chosen as it can all be stored in the same place. Version and activity control allowed to see all changes made throughout UI design process which was extremely important for documentation purposes.</p>
        
    </div>
    <div id="users">
        <h2> 2.1 Understanding the user <a class="bu" href="#">Back to Top </a></h2>

        <p>One of the first challenges when working on requirements from the client was to understand users of the
            system, what they are responsible for when working on field and how much access they are allowed to
            scientifically important data</p>
        <p>As per conversation with the client there will be 3 types of system users:</p>
        <ul>
            <li>Field staff-Input Data, but not export</li>
            <li>Coordinators-Input data and export reports</li>
            <li>Higher Level Staff-Export Basic reports but not input or edit data</li>
        </ul>

        <h3>Interaction with client</h3>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase2/understandusers.png" width="350" height="500"></td>
            </tr>
        </table>
        <p>Based on answers from client it was decided to build system that work on principle of least privilege (POLP).
            Instead of assigning each user to particular role, each user will be granted with list of privileges based
            on their role. </p>
        <p>List of privileges:</p>
        <ul>
            <li>Read (Can only view data)</li>
            <li>Create (Can add new data into system)</li>
            <li>Edit (Can modify existing information)</li>
            <li>Export (Can export reports)</li>
            <li>Admin (Has all of the above)</li>
        </ul>

        <p>In addition, Admins are able to register new users, assign privileges, modify users and delete users. Admins
            can delete other Admins which is needed in case people are no longer working on the research.
        </p>
    </div>
    <div id="stories">
        <h2> 2.2 User Stories <a class="bu" href="#">Back to Top </a></h2>

        <p> To get better understanding of user requirements and system functionality we have written users stories to
            describe different features of the system.</p>
        <h3> System Setup</h3>
        <ol>
            <li>As a researcher, I can attach a tag to a bird and keep track of the tag ID, enabling me to register the
                bird in the system.</li>
            <li>As a technician, I can setup the network linking feeders and the central hub. This allows me to install
                hardware and software components of the system from scratch.</li>
        </ol>
        <h3>System Usability</h3>
        <ol>
            <li>As a user, I can log into the system using my username and password</li>
            <li>As a user, I can log out of the system locking my account. For the system to be used again, the next
                user needs to enter their own username / password.</li>
            <li>As a user with privileges to add information into the system, I can register a tagged bird in the
                system. This allows the system to track the bird visits to feeders and store this data into database.
            </li>
            <li>As a user with privileges to edit data, I can edit data about a bird registered in the system to update
                a bird's details (such as status, condition etc.).</li>
            <li>As a user with privileges to view data, I can view any data held about birds.</li>
            <li>As a user with privileges to export data, I can filter the report before viewing/exporting it so that it
                shows only fields I am interested in. This allows me to narrow down the dataset to only relevant
                subjects.</li>
            <li>As a user with admin privileges, I can register a new user and assign them with appropriate privileges.
                This ensures that each user of the system has the minimal amount of access required to carry out their
                duties without compromising additional
                functionality of the system.</li>
            <li>As a user with view privileges I want to see the most relevant data about birds first such as:
                Individual ID, Name, Sex, Male parent, Female parent, Age, Breeder or Non-Breeder, Nest site from the
                previous breeding season, Nest site distance
                to hopper.
            </li>
        </ol>
        <h3>System Maintenance</h3>
        <ol>
            <li>As a technician, I can update the system with a patch issued by the development team. This allows me to
                keep the system up-to-date and prevent software bugs and vulnerabilities from hampering normal
                operation.</li>
            <li>As a user with any type of privileges, I am notified if any part of the system is suspected to be
                non-functional (such as a broken communications link). This allows me to detect errors faster and
                recover while minimizing data loss.</li>
            <li>As user with any type of privileges, I can restart any part the system after a power / other failure to
                return it to an operational state.</li>
        </ol>

        <h3>New User stories based on interaction with the client</h3>
        <ol>
            <li>As a user with admin privileges, I can view a log of significant actions taken by other users of the
                system, such as registering a bird, connecting a feeder etc. This helps me troubleshoot and identify
                errors made by other team members, as
                well as to detect any unusual activity.</li>
            <li>As a user with any type of privileges I want to add list of new unassigned rings to the system.</li>
            <li>As a user with any type of privileges I want to keep track of assigned and unassigned rings.</li>
        </ol>
    </div>
    <div id="usecases">
        <h2>2.3 Use Case Descriptions <a class="bu" href="#">Back to Top </a></h2>
        <h3>2.3.1 About Use Cases</h3>
        The use cases were defined in the early stages of the project, loosely based on the user stories described in section 2.2. They were meant to provide us guidelines for what is expected of the system and how the
        users will interact with it. Due to the evolution of the requirements and overall system, some of the use cases later became outdated, irrelevant or not implemented
        due to technical difficulties / oversights; furthermore, some aspects of the current system (for example, live view) are not described in the use cases. Overall, however, they achieved their purpose of setting out a roadmap for development and keeping us on track to implement
        the most essential features.<br><br>
        The following sections contain all use cases as they were described originally. Where a use case doesn't reflect the current behaviour of the system, a short summary of the deviations and reasons will be provided.
        <h3>2.3.2 Bird Functionality</h3>
        <a href="Phase2/usecases/Bird_Functionality/UserViewsData.pdf"><h4>User Views Bird Data</h4></a>
        <p>The 'User Views Bird Data' use case is largely up-to-date, with the exception that the user requires Read privileges to view bird data - this was changed after defining the permissions model (described in section 2.1) 
            that specifies that users must have Read permissions to view bird data.
        </p>
        <a href="Phase2/usecases/Bird_Functionality/UserExportsDataFromDatabase.pdf"><h4>User Exports Bird Data from Database </h4></a>
        <p>
            Although the 'User Exports Bird Data from Database' use case specifies that the user should be able to select the bird who's data they're exporting, an export can only be made on the entire list of birds. The user can then use their spreadsheet software, such as Excel,
            to further filter the data and access the specific bird that they require. This change was made as the customer indicated they don't require the functionality to export data on a single bird.
        </p>
        <a href="Phase2/usecases/Bird_Functionality/UserRegistersBird.pdf"><h4>User Registers Bird </h4></a>
        <p>
            The 'User Registers Bird' use case specifies that the user must enter a RFID tag as a minimum to register a bird. In fact, assigning a RFID tag is not required when creating a new bird, and the only required field is 'Bird Name'.
            This change was made as we deemed it unnecessarily restrictive - our system now allows the user to also register birds that haven't been equipped with a RFID tag yet, but might be in the future.<br>
            A further change is that, even though validation is performed to check whether the RFID tag is currently un-assigned, it doesn't tell the user which bird it is assigned to. This was an oversight as this functionality could improve
            user experience by helping them troubleshoot data entry errors.
        </p>
        <a href="Phase2/usecases/Bird_Functionality/UserEditsData.pdf"><h4>User Edits Bird Data</h4></a>
        <a href="Phase2/usecases/Bird_Functionality/UserImportsRingsIntoSystem.pdf"><h4>User Imports Rings into System </h4></a>
        <a href="Phase2/usecases/Bird_Functionality/UserRegistersNestSite.pdf"><h4>User Registers Nest Site </h4></a>
        <h3>2.3.3 System Maintenance</h3>
        <a href="Phase2/usecases/System_Maintenance/10_Network_setup.pdf"><h4>User Sets up Network</h4></a>
        <p>
            The 'User Sets up Network' use case mentions that the channel, network id and node identifier must be set on the microcontroller. As we decided against using a microcontroller (explained in section 1.1) but instead connect the ZigBee to the RFID directly,
            these parameters must be set on the ZigBee instead.
        </p>
        <a href="Phase2/usecases/System_Maintenance/1_SystemNotifyUserOfFailure.pdf"><h4>System Notifies User of Failure</h4></a>
        <p>
            The 'System Notifies User of Failure' use case is obsolete. As described in section 1.1, we use AT mode on our ZigBees, which makes it impossible to automatically detect when a network device goes offline. This was one of the main drawbacks
            of using AT mode over API mode, however the benefits outweighed the negatives, and so plans for this functionality were scrapped.
        </p>
        <a href="Phase2/usecases/System_Maintenance/2_UserRecoverHubFromFailure.pdf"><h4>User Recovers Hub from Failure</h4></a>
        <a href="Phase2/usecases/System_Maintenance/4_UserUpdatesHub.pdf"><h4>User Updates Hub</h4></a>
        <h3>2.3.4 User Management</h3>
        <a href="Phase2/usecases/User_Management/UserRegistration.pdf"><h4>Admin Registers User</h4></a>
        <p>
            The 'Admin Registers User' use case is largely up-to-date, with the exception that the 'Register New User' button is available from the Manage Users screen instead of the navigation menu. This change was made as part of the evolution
            of the design prototype (Phase 4).
        </p>
        <a href="Phase2/usecases/User_Management/DeleteUserProfile.pdf"><h4>Admin Deletes User Profile</h4></a>
        <p>
            The 'Admin Deletes User Profile' use case is largely up-to-date, with the exception that the page where users can be deleted is called 'Manage Users' instead of 'View All Users'. This change was made as part of the evolution
            of the design prototype (Phase 4).
        </p>
        <a href="Phase2/usecases/User_Management/LogIn_LogOut.pdf"><h4>User Logs In & User Logs Out</h4></a>
        <p>
            The 'User Logs Out' use case describes that the system should ask the user for confirmation if they have unsaved changes and they attempt to log out. In fact, as all edit / create functionality is done using modal pop-up forms, 
            the 'Log Out' button is inaccessible while editing / creating new data. Instead, a confirmation is requested when the user attempts to close a form with unsaved changes. This change was made as part of the evolution
            of the design prototype (Phase 4).
        </p>
        <a href="Phase2/usecases/User_Management/ViewLogs.pdf"><h4>Admin Views Logs</h4></a>
    </div>
    <div id="reqdoc">
        <h2> 2.4 Requirements Document <a class="bu" href="#">Back to Top </a></h2>
    </div>
    <div id="datadi">
        <h2> 3.1 Database Diagram <a class="bu" href="#">Back to Top </a></h2>

        <p>
            The Database underwent many iterations due to factors such as client input or oversight in planning and
            finding we needed some extra data or we had unused fields, so in this section we will walkthrough the main
            stages and the factors leading to the change. The diagrams can get a bit big and don't fit in well with the
            layout so instead they will be linked so they can opened in a separate view. <b>(Version 1 of the Diagram
                was done by Afzaal Ahmad Razeem, all versions after are by Priyesh Patel.)</b>
        </p>
        <h3> Version 1</h3>
        <p>For our initial design all we had to go on was the input we had from a client email when we asked for a
            sample of their current data spreadsheet however due to some data sharing rules this was not possible so
            instead we were sent the table headings with some dummy data. See below for the interaction: </p>
        <img src="Phase4/v1clientInput.png" class="centerTrue"></img>
        <p>Based off what was interpreted from the dummy data and our own understanding of what the system should be,
            this version was made <a href="Phase4/BirdsV1.jpeg" target="_blank">(click here to open diagram image)</a>. </p>
        <h3> Version 2</h3>
        <p>V2 was a small update to add some missing information (such as group name) and to include user permissions
            based off of the interactions discussed in the <b>Understanding the user</b> section. Also the missing table
            for RFID tags was added in and the unnessacary separation of user and user details was removed.
            <a href="Phase4/BirdsV2.png" target="_blank">(click here to open diagram image)</a>
        </p>
        <h3> Version 3</h3>
        <p> For V3 we removed the unneeded splitting of Bird, Status and Bird Creation Details. They were all one to one
            relations so I just made sense to have them in one table (even though that did mean a rather large one).
            <a href="Phase4/BirdsV3.png" target="_blank">(click here to open diagram image)</a></p>
        <h3> Version 4</h3>
        <p> V4 was mostly a tidying up of V3 but we also made a change in that the user and permissions table was
            combined (following the same reasoning as Bird Table in V3) and an overlooked part of one of the client's
            request was added in, which was the ability to see previous nest sites, to do this we thought it would be
            necessary to add in a table for nest sites.
            <a href="Phase4/BirdsV4.png" target="_blank">(click here to open diagram image)</a></p>
        <h3> Version 5</h3>
        <p> As we got further into development some inadequacies in the database started to show, such as a lack of
            being able to properly handle historical nest sites, to counter this a new table was added called bird nest
            to link a bird to a nest site along with the date it entered and left based off of client request that was
            overlooked earlier on. Similarly distance to hopper was added and birdID was added in the RFID table to ease
            the complexity of the Python Reader Scripts Also the feeder table was removed as the client didn't express
            interest in managing specific feeding locations as we have for nest sites so instead a field with feeder ID
            was added to visits.
            <a href="Phase4/BirdsV5.png" target="_blank">(click here to open diagram image)</a></p>
        <h3> Version 6 - Final</h3>
        <p> As development ramped up in it's final stages the models in the system began to change often, at which point
            it was no longer feasible to keep updating this diagram, so V6 was created retroactively at the end of
            development to model the final state of the database.<br><br> As you'll be able to tell from the image of
            this diagram <a href="Phase4/BirdsV6.png" target="_blank">(click here to open diagram image)</a>, a lot has changed from V6.
            <ol>
                <li>
                    We have a new lock table which was created for Karlis' concurrent access locking mechanism
                </li>
                <li>
                    there were missing fields added in to nest site for coordinates which was brought to our attention
                    during the first client system demo
                </li>
                <li>
                    the were missing fields added to bird which were noticed when creating the more filters and
                    exporting functionality
                </li>
                <li>
                    there are new user permissions added to User (isSuperAdmin) which were picked up during a client
                    meeting where we were demonstrating the system a second time
                </li>
                <li>
                    Due to the complexity of API mode for the ZigBee readers and the time constraint on development we
                    could no longer get a feeder ID so this had to be removed from visit, luckily this was a nice to
                    have feature for the client and not a must have, but it's a perfect candidate for future
                    improvement.
                </li>
            </ol>
        </p>
    </div>
    <div id="netdi">
        <h2> 3.2 Network Diagram <a class="bu" href="#">Back to Top </a></h2>
        <img src="Phase4/Img/NetworkDiagram.svg" class="center"></img>
    </div>
    <div id="sysdi">
        <h2> 3.3 System Diagram <a class="bu" href="#">Back to Top </a></h2>
    </div>
    <div id="lofi1">
        <h2> 4.1 Lo-Fi Design 1 <a class="bu" href="#">Back to Top </a></h2>
        <p>The first to Lo-Fi designs were attempted using myBalsamiq tool. The idea of the first prototype was to decide on basic layout for buttons and how data will be displayed on the screen. Below is an example of first Lo-Fi version of Log In page and Home screen that was designed using myBalsamiq tool.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Home Screen </td>
                <td id="img"> Log In </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase4/lofihomescreen.png" width="400" height="200"></td>
                <td id='img'><img src="Phase4/login.png" width="400" height="200"></td>
            </tr>
        </table>
        
        <p>
        We have requested 'dummy' data from the client to understand what sort of information is stored in the system. Due to data sharing agreement with MWF, our client was unable to send the actual data that is currently being stored about birds, however we received an excel spreadsheet that included all database fields that need to be included in the system. Based on this information we started to plan the system. 
        </p>
        
        <table id="lofitable1" border="0">

            <tr>
                <td id="img"><img src="Phase4/dummy1.png" width="600" height="100"></td>
            </tr>
            <tr>
                <td id='img'><img src="Phase4/dummy2.png" width="600" height="100"></td>
            </tr>
            <tr>
                <td id='img'><img src="Phase4/dummy3.png" width="600" height="100"></td>
            </tr>
            <tr>
                <td id='img'><img src="Phase4/dummy4.png" width="600" height="100"></td>
            </tr>
            <tr>
                <td id='img'><img src="Phase4/dummy5.png" width="600" height="100"></td>
            </tr>
        </table>
        
        <p>The challenge was to understand how to divide all the information that is collected about birds and how frequently it is used e.g. daily, weekly or monthly. We have sent a number of questions to client to understand what information is needed for immediate access. </p>
        
        <table id="lofitable1" border="0">

            <tr>
                <td id="img"><img src="Phase4/dailyinfo.png" width="325" height="250"></td>
            </tr>
        </table>
    
        
        
    </div>
    <div id="lofi2">
        <h2> 4.2 Lo-Fi Design 2 <a class="bu" href="#">Back to Top </a></h2>

        <p>Based on interaction with the client, we came up with the idea to show 'Live View'of birds visiting feeders. It would include information that is collected on daily basis such as: bird's condition, time of visit and bird's unique identifiers such as name, Left Ring ID and Right Ring ID. The idea was communicated back to client and it was approved. Based on this we have begun to design 'Live View' of the system. </p>
        <br>
        
        <table id="lofitable1" border="0">

            <tr>
                <td id="img"><img src="Phase4/liveviewproposal.png" width="325" height="200"></td>
            </tr>
        </table>
        
        <p>Next version of UI prototype was created using Google Slides. Version 1 below shows new two-pane design which has Live View as a main screen and menu bar on the left. We have produced mock data based on conversation with client about what whata is used on daily basis. This version of Live View gave an idea of basic layout for the system, however it lacked many user friendly features. </p>
        
        <h3> Live View Version 1</h3>
        <table id="lofitable1" border="0">
           

            <tr>
                <td id="img"><img src="Phase4/lofiliveview2.png" width="400" height="200"></td>
            </tr>
        </table>
        <br>
        
        <h3> Live View Version 2 - Designed by Priyesh Patel</h3>
        
        <p>Live View version 2 included number of user-friendly features that improved systemâ€™s usability. </p>
        <table id="lofitable1" border="0">
            <tr>
                <td id='img'><img src="Phase4/lofiliveview3.png" width="600" height="350"></td>
            </tr>
        </table>
        
        <ol>
        <li>Pagination was added into Live View. In previous version, information was displayed as a large list of entries which would be difficult to understand and oversee. </li>
        <li>Number of entries filter allowed users to restrict number of table entries displayed on screen.</li>
        <li>Time filter allowed to pick specific time of the day when birds are visiting feeders. </li>
        <li>Text filter allowed to search for specific bird by typing its name or ring information.</li>
        <li>Text label next to pagination bar allowed to see how many entries there are in total on the Live View. </li>
        </ol>
        
        <p>Whilst this Lo-Fi version of UI was a big improvement from Version 1 it was still unclear what functionality should it include as well as it was unclear how we will be developing the system. The initial plan was to use Java programming language to develop the system, however during the development planning phase the plan changed. </p>
        
    </div>
    <div id="hifi1">
        <h2> Hi-Fi Design 1 <a class="bu" href="#">Back to Top </a></h2>
        <p> This version of UI design was created once we decided that for system development, we will be using sails.js web application framework which supports large number of user-friendly UI features. The initial web app layout gave us an idea for new system's layout which enabled us to created new version of UI prototype. The priority was to concentrate on displaying data in Live View, in Single Bird View and Bird Table view. Based on this, other parts of the system can be constructed in the same way to create consistent UI throughout the whole system.</p>
        <h3> Live View</h3>
        <p>In order to display as much information as possible we decided to locate drop-down menu at the top of the
            page in the left corner which freed up the space to display more information on the screen. More
            sophisticated time filters were added in
            order to find specific bird visit times. Users can search for birds by typing bird's name in the search box.
            Pagination bar has been kept and is located in the footer to enable users to navigate through large amount of data more easily. If users
            wanted to view full information
            about bird that showed up on the live view they can press 'View' button at the end of the row and it would
            open new view with bird information.
        </p>
        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Live View Version 3 </td>
                <td id="img"> Live View Version 3 with Menu </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase4/hifiliveview1.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/hifiliveview2.png" width="400" height="200"></td>
            </tr>
        </table>

        <p>This version of 'Live View' has been modified number of times. Table has been moved to centre. First column
            has been removed to avoid unnecessary information on the screen as it does not serve any purpose for
            researchers. Menu has been moved to
            the top right corner and 'Live View' button has been added so that users can always return to live screen
            from any view. 'View' button at the end of each row has been also removed as we decided that this option can
            be replaced with different
            functionality such as pressing on the table entry. This made Live View less cluttered from unnecessary
            buttons. </p>

        <p>We also had to decide on the ways of showing users when visits have been registered in the system. If new
            visits were added automatically, it would distract users from viewing Live View, therefore system was
            developed in the way that it would
            inform users when new visits were registered and advice users to refresh the page.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Live View Version 4</td>
                <td id="img"> Live View Version 4 with Menu </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase4/liveview4.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/liveview4menu.png" width="400" height="200"></td>
            </tr>
        </table>


        <h3> Single Bird View</h3>
        <p>One of the ways to open single bird view is by clicking on 'View' button from Live View screen. All
            data is aligned to centre and buttons are added to expand more information about birds such as: Parent
            information, More information and
            table with past visits. 'Edit' button in the footer allows to edit information in this view.
        
        </p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Bird View </td>
                <td id="img"> Bird View Edit Mode </td>
            </tr>
            <tr>
                <td id="img"><img src="Phase4/birdview.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/birdviewedit.png" width="400" height="200"></td>
            </tr>
        </table>


        <p>Based on client requirement Single Bird view has been modified. Instead of arranging all data in one column, decision has been made
            to display information in two columns. This enables users to see more data on the screen. 'Export' button
            has been added in the footer
            to export information about one bird as requested by the client, however this function has been removed at
            the later stage after user testing as client advised that this function will not be used and there is no need to export information about sigle bird. </p>



        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Bird View Version 2</td>
                <td id="img"> Bird View Edit Mode Version 2 </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase4/birdview2.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/birdviewedit2.png" width="400" height="200"></td>
            </tr>
            <tr>
                <td id="img"><img src="Phase4/birdview2.2.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/birdviewedit2.2.png" width="400" height="200"></td>
            </tr>
            
            
            
        </table>
        <table>
            <tr>
                <td id="img"><img src="Phase4/birdviewdecision.png" width="400" height="175"></td>
            </tr>
        </table>
        
        <h3> Birds Table View</h3>
        <p>In order to create this view, we had to understand what is the most important information that needs to be accessed immediately. The first email interaction with the client included information about what fields are the most important to researchers that need to be accessed when viewing information about birds. </p>
         <table>
        <table>
            <tr>
                <td id="img"><img src="Phase4/birdsviewdata.png" width="400" height="400"></td>
            </tr>
        </table>
        <p>Based on this reply we have created Birds table. The design is consistent with Live View and displays the most relevant information requested by the client. At the top of the page there are number of filters that allows users to narrow down the search. 'Export' button located in the footer allows users to export the view that is currently displayed and 'Show Full View' button enables users to access all information about each bird. When users hover over one of the bird's entries it gets highlighted and users can open this particular bird's view showed above. </p>
        <table>
            <tr>
                <td id="img"><img src="Phase4/birdstable.png" width="400" height="200"></td>
            </tr>
        </table>
        <h3> Manage Rings View</h3>
        <p>Once main screens that display the most important information about birds have been designed, new requirements arose such as keeping track of bird rings in the system.</p>
        <p>New view has been designed in order to overview new RFID enabled rings. This view was designed in the same way as other views keeping all common features in the same place to keep design consistent.</p>
        <p>Table included all important information about rings such as: Printed ring ID, Ring colour, System ID, if ring is assigned to bird or not, which bird ring is assigned to and assignment date. It was requested by client to have this information displayed in this (Meeting Minutes - 1st February). This view included section at the top to import new rings from CSV file. </p>
             
        <table>
            <tr>
                <td id="img"><img src="Phase4/managerings.png" width="400" height="200"></td>
            </tr>
        </table>
             
        <h3> User Management (Admin section) </h3>
        <p>As per client's requirements user management was only done by system admins. Users whose privileges included admin rights had access to view all users of the system, register new users and view user activity monitor. </p>
             
        <table>
            <tr>
                <td id="img"><img src="Phase4/usermanagement.png" width="300" height="150"></td>
            </tr>
        </table>
             
        <p>Admin option on the menu bar is only visible to those users who have admin rights. </p>
            <table>
            <tr>
                <td id="img"><img src="Phase4/adminmenu.png" width="200" height="150"></td>
            </tr>
        </table>
             
        <p>Information about all users is displayed in the table similarly like other information stored about birds. In order to view particular entry admin has to click on one of the entries in the table and new window will open with option to delete or edit another user.</p>     
        
        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> View Users </td>
                <td id="img"> View Single User </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase4/viewusers.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/viewsingleuser.png" width="400" height="200"></td>
            </tr>
            
            <tr>
                <td id="img"> Register New User </td>
                <td id="img"> Delete User </td>
            </tr>
           
            <tr>
                <td id="img"><img src="Phase4/registeruser.png" width="400" height="200"></td>
                <td id="img"><img src="Phase4/deleteuser.png" width="400" height="200"></td>
            </tr>
            
        </table>     
             
    </div>
    <div id="hifi2">
        <h2> Hi-Fi Design 2 <a class="bu" href="#">Back to Top </a></h2>

        <h3>Contrast checker</h3>
        <p>Following first UI prototype test, client agreed to chosen colour scheme for the system. However, chosen
            colours failed contrast checker criteria.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase4/contrastfail.png" width="350" height="225"></td>
            </tr>
        </table>

        <p>To meet usability standard, colours had to be modified. As client already agreed to chosen colours scheme, we
            decided to use same colours, but modify shades and brightness. Pictures below show that new colours have
            passed the contrast checker criteria. Colours in the system have been adjusted to match with these colours.
        </p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase4/contrastpass1.png" width="350" height="225"></td>
                <td id="img"><img src="Phase4/contrastpass2.png" width="350" height="225"></td>
            </tr>
        </table>

    </div>
    <div id="scripts">
        <h2>5.1 Coordinator Service<a class="bu" href="#">Back to Top </a></h2>
        <h3>5.1.1 High Level Activity Diagram</h3>
        <img src="Phase5/Img/Python_HighLevel.svg" class="center"></img>
        <h3>5.1.2 Config</h3>
        <p>
            Configuration parameters are defined in <a href="Phase5/Src/config.py"
                target="_blank"><code>config.py</code> (follow link to see an example with comments)</a>. Parameters are
            validated in two steps - static (explicit) and dynamic (implicit).
            In the static step, the following conditions must be met:
            <ul>
                <li>
                    <code>config.py</code> exists
                </li>
                <li>
                    Required parameters defined (<code>db_host</code>, <code>db_user</code>, <code>db_password</code>,
                    <code>db_port</code>, <code>db_name</code>)
                </li>
            </ul>
            Parameters related to the database are the only required values as the service can't make reasonable default
            guesses. The static step also internally sets the default values where applicable. If one of the conditions
            above is not satisfied, the service
            exits with a descriptive error message (eg. <code>"Missing required config param db_name"</code>). If a
            default value is used, the service outputs a log informing the user (eg.
            <code>"Missing optional config param log_level, using default = 'WARNING'"</code>,
            or
            <code>"Unknown log_level value TRACE in config, must be one of 'DEBUG' | 'INFO' | 'WARNING' | 'ERROR' | 'CRITICAL'. Using default = 'WARNING'"</code>).<br><br>
            The dynamic step occurs when the service attempts to use the provided parameters
            to connect to the database and serial port. If either of the connections fail, the service exits with an
            error message informing the user what went wrong (eg.
            <code>"Couldn't connect to database, make sure it's running and the correct connection params are set in config.py"</code>).
        </p>
        <h3>5.1.3 Reading RFID packets</h3>
        <p>
            The RFID packets are 13 bytes long and have the following structure:
            <table>
                <tr>
                    <th>Start byte (static - 1 byte)</th>
                    <th>Unused (static - 3 bytes)</th>
                    <th>Tag Data (varies - 7 bytes)</th>
                    <th>XOR checksum (varies - 1 byte)</th>
                    <th>End Byte (static - 1 byte)</th>
                </tr>
                <tr>
                    <td>
                        <code>0xAA</code>
                    </td>
                    <td>
                        <code>0x0F 0x08 0x00</code>
                    </td>
                    <td>
                        <code>0x03 0x84 0x12 0xDB 0xFA 0xE7 0xD5</code>
                    </td>
                    <td>
                        <code>0xB1</code>
                    </td>
                    <td>
                        <code>0xBB</code>
                    </td>
                </tr>
            </table>
            Testing showed that packets are not separated from one another in the incoming serial data stream.
            Therefore, a mechanism was required to deal with the possibility that a network error causes us to receive a
            packet with missing, or extra, bytes. Simply
            relying on start and end bytes would not be sufficient, as the tag data can also contain <code>0xAA</code>
            and <code>0xBB</code>. Therefore, the code builds up a buffer that always starts with <code>0xAA</code>, is
            at least 13
            bytes long, and always ends with <code>0xBB</code>. This increases the chance that the buffer will contain a
            valid packet and minimizes data loss by allowing for some network noise before or after the packet. This is
            achieved with the following
            code:
            <pre><code>
                    buffer = bytearray()
                    while True:
                        read = self.ser.read(1)[0] # read one byte at a time
            
                        if read == 0xBB and len(buffer) >= 12:
                            # we've read the end byte and the buffer is at least as big as the expected packet size,
                            # so parse what we have (async)
                            buffer.append(read)
                            threading.Thread(target=self.__handle_read, args=(buffer,datetime.datetime.now())).start()
                            buffer = bytearray()
                        elif len(buffer) == 0 and read != 0xAA:
                            # the buffer is empty but we've read something other than the start byte, so let's discard this
                            logging.debug("Read byte %X but expecting start byte 0xAA, discarding this read", read)
                        else:
                            buffer.append(read)
            </code></pre> The buffer is then handled asynchronously (described in section 5.1.4) to prevent blocking
            new incoming data.
        </p>
        <h3>5.1.4 Buffer handling</h3>
        <p>
            The raw buffer is handled by a function that attempts to extract a 13-byte packet that starts with the start
            byte and ends with the end byte, as well as passes XOR checksum validation. If no valid packet is found, the
            buffer is discarded. This is achieved
            with the following code:
            <pre><code>
                        # tries to extract a single packet from the raw data we received
                        # the raw data should have at most one packet of length 13, starting with 0xAA and ending with 0xBB
                        # if no valid packet found in the data, return None
                        def __try_extract_and_validate_packet(self, incoming_bytes):
                            if len(incoming_bytes) < 13:
                                return None # this shouldn't ever happen
                            else:
                                logging.debug("Received a data buffer with 13 or more bytes, attempting to extract packet")
                                start_index = 0
                                end_index = 12

                                while end_index < len(incoming_bytes):
                                    start_byte = incoming_bytes[start_index]
                                    end_byte = incoming_bytes[end_index]

                                    if start_byte == 0xAA and end_byte == 0xBB:
                                        supposed_packet = incoming_bytes[start_index:end_index+1]
                                        logging.debug("Extracted something that looks like a packet: %s, validating...",
                                            supposed_packet.hex())
                                        if(self.__validate_packet(supposed_packet)):
                                            logging.debug("Validation succeeded, we've found a packet in our data")
                                            return supposed_packet
                                        else:
                                            logging.debug("Validation failed, continuing search for packet")

                                    start_index += 1
                                    end_index += 1 
                                    # if we've reached this point, we either didn't manage to extract a packet,
                                    # or it failed validation, so keep searching

                                return None 
                                # if we've reached this point, our loop failed to extract a valid packet,
                                # so signal to the caller that we've failed by returning None
                </code></pre> If a valid packet is found, it (along the date and time the buffer was received) is then
            passed to the database service, described in section 5.1.5.
        </p>
        <h3>5.1.5 Packet Handling</h3>
        <p>
            The service retrieves the relevant RFID record from the database according to the payload of the packet (if
            no RFID records are found, the packet is discarded). It then checks whether there have been any visits
            recorded from this RFID record within the
            period defined by same_visit_frequency_minutes setting in the config file. If there are, the packet is
            discarded. If not, a new record is written in the visit table in the database, containing the date/time the
            buffer was received, the RFID
            record ID and the bird record ID (if present). The visit table is read directly by the main application to
            detect and show new visits. If at any point the connection to the database is dropped, the service attempts
            to reconnect up to five
            times before giving up and exiting with an error message.
        </p>
        <h3>5.1.6 Future Improvements</h3>
        <p>
            <ul>
                <li>
                    <strong>Automatic serial port scanning.</strong><br> Currently, the person launching the service
                    must specify the serial port name in the configuration file. Although the service is intended to be
                    used only by technical users, this
                    can still present a challenge if the user is unfamiliar with the operating system or serial
                    communication in general.<br> This wasn't included due to extensive testing required to ensure that
                    the automatic scanning is reliable and
                    does not introduce more problems that it solves.
                </li>
                <li>
                    <strong>Abstraction of the database layer.</strong><br> Currently, raw SQL queries are used by the
                    service to interact with the database. This presents possible maintenance difficulties in the future
                    as small errors can lead to catastrophic
                    consequences, and code readability is compromised. Object-relational mapping (ORM), similar to the
                    one used for the main system, could be used instead.<br> This wasn't included due to an aim to keep
                    the service lean and reduce level
                    of bloat. However, the right ORM implemented correctly could offset these negatives with the
                    positives it brings.
                </li>
                <li>
                    <strong>Support of API mode.</strong><br> Currently, the service can only read data received in XBee
                    AT mode (AT and API modes compared in section 1.1.1). API mode support could be added as it allows for
                    greater extensibility and more
                    features, such as identifying when a network device has gone offline.<br> This wasn't included due
                    to the increased complexity of API mode and the system requirements lacking features that could make
                    use of API mode.
                </li>
            </ul>
        </p>

    </div>
    <div id="datamodel">
        <h2> 5.2 Database & Models <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.2.1 Creation</h3>
        <p>
            in the early stages of development we used Sails' built-in datastore called: <code> sails-disk</code>. This
            let us manually create entries that only existed during that run of the program. This was fine for when we
            were creating simple pages
            such as the login page but in the larger tests and for actual production we needed a proper database, so
            around the time that live view was starting to be developed the MySQL database was created. With use of v1
            of the database diagram, scripts
            were made to create corresponding tables. The full script can be viewed in <a
                href="Phase5/src/echoDBSetup.sql"><code>echoDBSetup.sql</code> (Click to open document)</a> <br><br>
            These tables were then used to generate the Models in our Source Code, <code>located in api/models</code>,
            using the Node Plugin <a href="https://www.npmjs.com/package/sails-inverse-model"
                target="_blank"><code>sails-inverse-model</code> (click to go to plugin's npm page)</a>.<br><br>
            These models have a set of built-in methods that allow us to interact with the database. <br><br>If these
            models are modified Sails can uses them to create new tables by running the system using
            <code>sails lift --drop</code> to drop the old tables and create new ones. So after the first versions of
            models were generated we could just update the models instead of updating the original scripts and
            rerunning. Although we could have used this method of creating the model first and letting Sails create the
            tables to make the original version We selected to use the script method as it was easier to verify that the
            diagram was actually workable and to check if Sails handled the data types we wanted as expected.

        </p>
        <h3>5.2.2 Test Data</h3>
        <p>
            Now that the database was in place we created a set of insert statements to generate dummy data based on
            input from the user on the data they currently use and based on what we knew we would need to test any edge
            cases, such as a bird visiting when it hasn't been registered. These statements had to be updated whenever
            the database was changed and if new cases were found that could test limits of the system. The full script
            can be viewed in <a href="Phase5/src/AiOData.sql"><code>AiOData.sql</code> (Click to open document)</a>.
        </p>
    </div>
    <div id="css">
        <h2> 5.3 CSS Styling & Matching UI Design <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.3.1 Initial Styling - Priyesh Patel</h3>
        <p>
            Sails.js provides an overall page layout in which common elements can be put and the body of the page can be
            injected when ran, originally the common elements included both the header and footer bars but for our
            system we altered the footer on most pages so I removed this and switched it to be injected with the body.
            For the actual styling Sails has Bootstrap 4 preinstalled (a vast library of front-end elements) so we used
            this as a base and modified what we needed, for a proof of concept I stylized the live view page using some
            quick inline CSS, this was then taken over by Afzaal who extracted CSS to their own files and tweaked, added
            to and applied them globally.
        </p>
        <h3>5.3.2 Full System Styling - Afzaal Ahmad Razeem</h3>
        <p>
            A lot of effort has been put to make the overall website interactive and easy to navigate. We have tried to make it consistent and easy to use web interface.
        </p>
        <h4>5.3.2.1 Contrast and colour</h4>
        <p>
            We chose the colours very carefully including the theme colours, buttons, text. The chosen colours were agreed with the client and we made sure
            that they meet usability standards. The colours are kept consistent throughout the website.
        </p>
        <h4>5.3.2.2 Buttons</h4>
        <img src="Phase5/Img/buttons.png" class="center"></img>
        <p>
            Many different types of buttons are used(these are shown in the image above). All the buttons are kept consistent throughout the webiste and followed the 
            UI prototype.
            <!-- for example same button is used for cancel button for the whole website. moreover, position of the buttons is kept consistent as well, 
            for example cancel/close button are always on the left side of the modals whereas save/create buttons are on the right side. -->
        </p>
        <h4>5.3.2.3 Modals</h4>
        <p>
            On different pages, modals have been used instead of new pages. That way we have less pages for the whole website which also makes it easier for users to 
            navigate through the website. For example, viewing bird, editing bird and registering bird are using modals and can be accessed from birds page. 
        </p>
        <h4>5.3.2.4 tables</h4>
        <p>
            Tables have been used throughout the website. We have used the same colours, styles, font sizes for all the tables to make is consistent. For example, the first
            column and first row of every table has a different colour which was kept consistent throughout the website.
        </p>



        <h3>5.3.3 UI Design Compliance & Client Requested Changes - All</h3>
        <p>
            throughout the styling process we used the latest UI Design as our reference, and for pages that weren't
            fully defined we used some common sense and made sure the overall style matched the rest of the defined
            pages. There are some discrepancies between UI Design and the end product due to some input we gathered from
            the client during live demonstration meetings (see screenshot below), such as the buttons for adding new
            records being moved above tables instead of below and some name changes.
            <img src="Phase5/Img/clientStyle.png" class="center"></img>
        </p>
    </div>
    <div id="log">
        <h2> 5.4 Login / Logout <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.4.1 Logging in</h3>
        <img src="Phase5/Img/login.png" class="center"></img>
        <p>
            Login is a simple screen that shows two input fields for username and password, and a "Remember me" checkbox for extending the lifetime of the user's session if ticked. User can login using their unique username and password. When "Sign in" button is clicked,
            data is sent to the back-end <code>login.js</code> which attempts to look up the user record in the database with the specified username. Then, if the username exists, it uses
            bcrypt to compare the hashed password from the database with the provided password. If that matches then user is logged in and redirected to the home page.
        </br>
            if however, username does not exist in the database or provided email and password combination does not match any user in the database, 
            it displays a message saying that username and/or password is incorrect.
            <img src="Phase5/Img/login-2.png" class="center"></img>
        </p>
        <h3>5.4.2 Logging out</h3>
        <p>When user clicks on Log out button, data is sent to <code>logout.js</code>. This action deletes the req.session.userId key from the session of the requesting user agent. 
            After logging out from a web browser, the user is redirected to the login page. </p>



    </div>
    <div id="live">
        <h2> 5.5 Live View <a class="bu" href="#">Back to Top </a></h2>
    </div>
    <div id="bird">
        <h2> 5.6 Bird View <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.6.1 Viewing All Birds</h3>
        <img src="Phase5/Img/all-birds.png" class="center"></img>
        <p>
            The Birds are displayed in a simple paginated HTML table, following the design of similar pages. The Birds data for the current page is pulled from the back-end (<code>get-bird.js</code>) 
            and the table is populated using a v-for loop. When the page is loaded, instead of displaying all the information about the birds it only displays the important and frequently accessed
            information which was discussed and agreed with the client.</br>
            Filtering is available on the fields using a contains-match except for "Gender", "Status" and "Breeder" which are made a drop down options for user to choose from instead of typing.
            Filtering is done in the backend and the list of matching Birds is updated as soon as the user types or edits anything in any of the filter fields. All filters can be cleared by clicking "Clear Filters" button.
        </p>
        <h3>5.6.2 More Fields</h3>
        <img src="Phase5/Img/more-data.png" class="center"></img>
        <p>
            The user is able to view more data about the birds by adding extra columns to the Birds Table. By clicking "More Fields" button, the user is presented with a 
            modal of all the columns which can be selected to be added to the table. Fields are added to the table in order to how they are shown in the modal. User can select all the fields by
            clicking on "Select All", instead of selecting each field manually. Once the fields are added to the table, filters are also added for the selected fields.
        </p>
        
        <h3>5.6.3 Viewing Single Bird</h3>
        <img src="Phase5/Img/single-bird.png" class="center"></img>
        <p>
            Each row from the Birds table can be clicked to get further details of the specific bird. Details are displayed in a modal using v-for loop. 
            Details of the bird are divided into 4 main sections including the past visit history of the bird which is displayed in an other paginated table(image below). 
        </br>
            Condition History is also added in the single view which displays the most currently added condition of the bird. Condition History can be expanded further to see the past conditions of the bird.
    </br>
            All birds can be edited from single bird view by clicking the edit button. The modal can be closed by either clicking close button or simply clicking outside the modal.
        <img src="Phase5/Img/past-visit.png" class="center"></img>
        </p>

        <h3>5.6.4 Edit Bird</h3>
        <img src="Phase5/Img/editbird-ss.png" class="center"></img>
        <p>
            Bird data can be edited by pressing the 'Edit' button in Single Bird view. This makes all the fields
            in Single view editable. 
            The following live validation is
            performed on the form to ensure data integrity:
            <ul>
                <li>
                    Bird name must be present and unique
                </li>
                <li>
                    NFC Ring ID, if present, must be a registered ring that's not assigned to another bird
                </li>
                <li>
                    Where Hatched, Where Laid, Where Released, Where Fledged, New Breeding Site, if present, must be valid Nest Site records
                </li>
            </ul>
            If an invalid value is detected, the field is highlighted in red and the user isn't allowed to submit the form
            until they enter valid values:
            <div><img src="Phase5/Img/invalidbirdform-ss.png" class="center"></img></div>
            When the user clicks 'Save', if all values are valid, the new data is sent to the back-end
            (<code>edit-bird.js</code>), where the appropriate record is updated and saved in the database.
        </p>

        <h3>5.6.5 Register Bird</h3>
        <p>
            The 'Register Bird' modal can be accessed by pressing the 'Register New Bird' button in the full bird view
            (described in section 5.6.1). It looks and functions largely the same way as the 'Edit Bird' screen (described in section
            5.6.4). When the user clicks 'Save', if all values are valid, the new data is sent to the back-end
            (<code>create-bird.js</code>), where the appropriate record is created and saved in the database.
        </p>
        <h3>5.6.6 Future Improvements</h3>
        <ul>
            <li>
                <strong>Improve back-end efficiency.</strong> <br>Currently, the <code>get-bird.js</code> controller is very inefficient
                in the way that it retrieves and processes bird records. This causes degraded performance when viewing or filtering birds.
                This is because the object-relational mapping (ORM) system used in the backend (<a href="http://waterlinejs.org/" target="_blank">Waterline</a>)
                doesn't support complex filtering, such as nested fields or joined tables. This means that filtering and pagination must be done at the
                controller level which is much slower than doing it on the database level. Possible solutions include using a native SQL query or using a different
                ORM.<br>
                This wasn't done as it would have taken significant development / testing time to implement either of the two approaches outlined above. Nevertheless,
                this is one of the priorities when considering future development, as the performance is likely to worsen when more bird records are added.
            </li>
            <li>
                <strong>Split up the modal views.</strong><br> Currently, the single view, edit and create modals are very large with a lot of information being
                displayed at once. They could be made smaller by, for example, hiding some less-used fields by default.<br>
                Although the hiding approach was used in the earlier stages of development, the design prototype preferred by the user didn't include the option to hide any fields. Nevertheless, this could
                still be worked in while taking care not to limit functionality or efficiency of common tasks.
            </li>
            <li><strong>Allow user to view nestsite / RFID details by clicking on the relevant field.</strong><br>The RFID / nest site
                names
                in the 'NFC Ring ID', 'Where Hatched', 'Where Released', 'Where Fledged', 'Where Laid', 'Current Breeding Site' column could be clickable and bring up details of the relevant record.<br> This
                functionality wasn't added due to an oversight,
                as such functionality already exists in similar pages, such as Live View.
            </li>
            <li>
                <strong>
                    Link parent details to existing birds.</strong><br> Currently, the bird parentage details are a simple text field that makes no attempt
                    to link to existing birds in the system. Although the user should be able to log parent names even if they're not registered in the system,
                    it would be useful to match parent details to registered birds, if there are any.<br>
                    This wasn't done as it would require a change in our data model and, as the user hadn't indicated that they want this field to link
                    to existing birds, this change wasn't prioritized. Nevertheless, if implemented correctly, it could provide valuable information to the user, without
                    introducing any negatives.
            </li>
        </ul>

    </div>
    <div id="export">
        <h2> 5.7 Bird Data Export <a class="bu" href="#">Back to Top </a></h2>
        (this is a rather long file so it is not possible to show screenshots of all the relevant parts, <b><a href="Phase5/Src/export-data-bird-simple.js" target="_blank">click here to open the controller in a new window and to be able to see the parts discussed</a></b>. It should not be required, however, as I'll try my best to detail the basics here.)
        <h3>5.7.1 Exporting - Why & What we used</h3>
        <p>
            To support the legacy systems of the client we needed a way for the data on screen in the Bird View to be exported to an excel spreadsheet, originally this was planned to be done client side (i.e. in-browser) however we discovered a bug in the npm module we wanted to use (<a href="https://www.npmjs.com/package/sheetjs" target="_blank"><code>Sheet.js</code> (click to go to npm page)</a>) and Sails.Js. The conversion from a back-end node module to a front-end one requires the use of Sails' built-in <code>browserify.js</code> however this was not compatible (there is a strange bug where the conversion code generated and to reference the package it uses <code>"JS" + "zip" but it only works when it is "JSzip"</code>). <br><br>Because of this we decided to move the generation to the server side, since the file generated shouldn't be computationally expensive it was agreed that it wouldn't be an issue. During the research before making this change we found a module <a href="https://www.npmjs.com/package/node-excel-export" target="_blank"><code>node-excel-export</code> (click to go to npm page)</a> that was had documentation written specifically for Sails and had all the main features we needed, so we switched to using that to save some development time.
        </p>
        <h3>5.7.2 How it works</h3>
        <p>
            All the logic for the export is located in a single controller (<b>export-data-bird-simple.js</b>) and is accessed by the Bird View when export is pressed the exportToExcel function in <b>get-bird-page.js</b> is called (shown below) which checks which fields are currently being displayed and then use HTML GET to send them over to the export controller.
            <img src="Phase5/Img/exportToExcel.png" class="centerTrue"></img>
            <br> The export controller will then use this list of parameters to build a Specification array (see below for small snippet) which is used by node-excel-export to define the columns that will be in the report, it handles the name, style and size of each column and the key (seen as specification.KEYNAME in the image) is used to map on to the data from the database queries. A specification entry is required for each field and as such this is a rather long list of if statements checking each parameter from the get-bird controller and creating a matching specification.
            <img src="Phase5/Img/exportSpec.png" class="centerTrue"></img>
            <br> In order to get the data that the specification will map onto there are five different queries being used (lines 78 to line 155 in controller) and that's because this controller is essentially combining information from multiple pages (ring, nest, bird). In retrospect some of these could have been combined into joins however the complexity of refactoring outweighed the available time and had no visible benefit to the end user so it wasn't deemed a priority. This data then had to be processed row by row to create bird entries with keys matching that of the specification (see snippet below).
            <img src="Phase5/Img/exportData.png" class="centerTrue"></img>
            <br>After this, node-excel-export had all it needed to create the spreadsheet and use Sails' built-in document downloading features to send to the user for download.
            <img src="Phase5/Img/exportReportMaking.png" class="centerTrue"></img>
        </p>
        <h3>5.7.4 The End Report</h3>
        <p>
        from this report the user can use excel's built in filtering features to filter the data as they would have done in their old system (see below, on the top is the legacy sheet, on the bottom is our generated one. (<a href="Phase5/Asset/report 25-03-2019.xlsx">downloadable here for clearer view</a>))</p>
        <img src="Phase5/Img/exportReportFinal.png" class="center"></img>
        <h3>5.7.5 Future Improvements</h3>
        <ul>
            <li>
                <strong>Factor in active filters on the export data</strong><br>
                Currently Only the column selection is taken into account for selecting the data to create the report from however we have a filter bar that allows data to be filtered on screen so it would be a nice idea to see those active filters translate over on to the report (i.e. if the user is searching for birds with name containing "br" and then presses export, the report could only contain these birds). This can of course be done through excel anyway but requires an extra few clicks. It was not implemented due to 1) the time constraint (export was started very late in development); 2) the complexity of handling just the fields resulted in around 30 conditionals so adding in filter checks would have doubled the number of checks at the least; and 3) The most important reason we didn't add this was because the client said it wasn't a must have feature when we asked them after on of the live demonstrations (see below for interaction). So if there was time it would be a nice to have thing.
                <img src="Phase5/Img/exportClient.png" class="centerTrue"></img>
            </li>
            <li>
                <strong>Enable Filtering by default in spreadsheet</strong><br>
                This is just a small ease of life feature we would have liked to have but ultimately doesn't affect the features available to the end user. As it stands to turn on filtering in the excel report the user has to click Sort & Filter and then Filter, after this filters are ready to use. What we wanted was for these filters to be active by default so as soon as the report is open filtering options are already there to use however, the module we used for the export doesn't have a feature to do this and we only thought of this after everything had been written and the cost of rewriting and retesting with a different module didn't match up with the benefit of saving at most 2 clicks.
            </li>
        </ul>
    </div>
    <div id="ring">
        <h2>5.8 Ring Management <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.8.1 Manage Rings Screen</h3>
        <img src="Phase5/Img/managerings-ss.png" class="center"></img>
        <h3>5.8.2 Importing Rings</h3>
        <p>
            Rings are uploaded to the system in bulk, by the user submitting a <a href="Phase5/Asset/test.csv"
                target="_blank">CSV file (click link for example of valid CSV)</a>. When the user uploads a CSV file, it
            is validated client-side using the
            following criteria, all of which must pass:
            <ul>
                <li>
                    It is comma-separated column-wise
                </li>
                <li>
                    It is newline-separated row-wise
                </li>
                <li>
                    It has exactly three columns
                </li>
                <li>
                    The first row consists of the column headers and is exactly <code>short,long,colour</code>
                </li>
            </ul>
            If the file fails validation, the user is presented with the following error message:
            <code>Please upload a valid file. See tooltip for help.</code>. If the file passes validation, the user is
            presented with the following success message:
            <code>File is valid, you may proceed</code> and the 'Import' button becomes available.<br><br> When the user
            presses 'import', the CSV file is parsed to a JSON object and sent to the backend
            (<code>import-rfid.js</code>). In the backend, these
            values are inserted into the database, skipping non-unique records (uniqueness is determined by either the
            short ID or the long ID). When the backend has saved the new records to the database, it sends the number of
            inserted and skipped records
            back to the front-end, where it is presented as:
            <code>Successfully imported X rings. Y rings were skipped due to non-unique attributes (either short or long ID).</code><br><br>
            CSV validation and parsing makes use of the <a href="https://www.papaparse.com/"
                target="_blank"><code>papaparse</code> library.</a>
        </p>
        <h3>5.8.3 Viewing Rings</h3>
        <p>
            The rings are displayed in a simple paginated HTML table, following the design of similar pages. The ring
            data for the current page is pulled from the back-end (<code>get-rfid.js</code>) and the table is populated
            using a v-for loop. Filtering
            is available on the printed ring ID using a contains-match. Filtering is done in the backend and the list of
            matching rings is updated as soon as the user types or edits anything in the filter field.
        </p>
        <h3>5.8.4 Editing Rings</h3>
        <p>
            The user is able to delete rings that have not been assigned to a bird (assigned rings cannot be deleted
            without being un-assigned first, to prevent loss of data on rings that are in active use). Rings can be
            deleted by clicking on the bin icon (if the
            bin cannot be displayed, it is replaced by the text 'Delete Ring'). The user is prompted for confirmation
            and, if they accept, a request is sent to the backend (<code>delete-rfid.js</code>) to delete this ring
            record from the database.
        </p>
        <h3>5.8.5 Future Improvements</h3>
        <p>
            <ul>
                <li><strong>Allow insertion of single rings.</strong><br> Currently rings can only be inserted via a CSV
                    upload. Although this is handy when inserting a large volume of records, it makes inserting single
                    records tedious. A manual-entry form
                    could be included to insert new rings into the system one-by-one.<br> This wasn't included as the <a
                        href="Phase5/Img/usecase-importrings.png" target="_blank">relevant use case (click on link to
                        view)</a> only detailed bulk upload.
                    Nevertheless, from a user's perspective, manual entry could come in handy once in a while, and from
                    a developer's perspective, this would be a relatively simple task.
                </li>
            </ul>
            <ul>
                <li><strong>Allow ring assignment from this screen.</strong><br>Currently rings can only be assigned to
                    birds via the Bird View. It would be useful for the user to be able to also assign rings from this
                    screen.<br> This functionality wasn't
                    considered for development as the user is already able to assign rings through other means, however
                    it would increase user efficiency / productivity if the task could be achieved via this screen too.
                </li>
            </ul>
            <ul>
                <li><strong>Allow user to view the bird details by clicking on the bird name.</strong><br>The bird names
                    in the 'Assigned to Bird' column could be clickable and bring up bird details.<br> This
                    functionality wasn't added due to an oversight,
                    as such functionality already exists in similar pages, such as Live View.
                </li>
            </ul>
            <ul>
                <li><strong>Relax CSV validation.</strong><br>The <code>papaparse</code> library is quite powerful and
                    able to deal with CSV files in different formats, so current CSV validation is unnecessarily strict.
                    Some of the rules, such as column order,
                    could be removed altogether.<br> This wasn't done due to security concerns about allowing the users
                    to upload files in various formats to the back-end. Extensive testing could alleviate these concerns
                    but wasn't performed due to time
                    constraints.
                </li>
            </ul>
        </p>
    </div>
    <div id="nest">
        <h2>5.9 Nest Management <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.9.1 Manage Nest Sites Screen</h3>
        <img src="Phase5/Img/managenests-ss.png" class="center"></img>
        <h3>5.9.2 About Nest Sites</h3>
        <p>
            Nest sites are created to have references to locations on the site that can hold additional data about the
            locations such as coordinates and description. They are used in bird records to indicate important locations
            - for example, where the bird was hatched,
            or where it is currently breeding.
        </p>
        <h3>5.9.3 Creating Nest Sites</h3>
        <img src="Phase5/Img/createnest-ss.png" class="center"></img>
        <p>
            Nest sites are created through a modal form seen in the screenshot above. The following live validation is
            performed on the form to ensure data integrity:
            <ul>
                <li>
                    Nestsite name must be present and unique
                </li>
                <li>
                    Distance, latitude and longitude must be either empty or valid numbers (decimal points allowed)
                </li>
            </ul>
            If an invalid value is detected, the field is highlited in red and the user isn't allowed to submit the form
            until they enter valid values:
            <div><img src="Phase5/Img/invalidnestform-ss.png" class="center"></img>
            </div>
            If all values are valid, the data is sent to the back-end (<code>create-nestsite.js</code>) where the nest
            record is inserted in the database.
        </p>
        <h3>5.9.4 Viewing Nest Sites</h3>
        <p>
            The nests are displayed in a simple paginated HTML table, following the design of similar pages. The nest
            data for the current page is pulled from the back-end (<code>get-nestsite.js</code>) and the table is
            populated using a v-for loop.
        </p>
        <h3>5.9.5 Editing Nest Sites</h3>
        <p>
            The user can edit data on any nest site, except for its name. This is done by clicking on the 'Pencil' icon
            in the Actions column. If the icon can't be displayed, the text 'Edit nestsite' is shown instead. The edit
            screen is the same as the create screen
            seen in 5.9.3, with the exception that all fields are pre-poulated with existing data and the 'Nestsite
            name' field is disabled. When the user clicks 'Save', the new data is sent to the back-end
            (<code>edit-nestsite.js</code>)
            and the relevant record updated.<br><br> The user can delete any nest sites, including ones that are
            assigned to birds. In this case, the nest site will be removed from the bird's record. This is done by
            clicking on the 'Bin' icon in the Actions
            column. If the icon can't be displayed, the text 'Delete nestsite' is shown instead. The user is prompted
            for confirmation and, if they accept, a request is sent to the backend (<code>delete-nestsite.js</code>) to
            delete this nestsite record
            from the database.
        </p>
        <h3>5.8.6 Future Improvements</h3>
        <p>
            <ul>
                <li><strong>Allow breeding site assignment from this screen.</strong><br>Currently breeding sites can
                    only be assigned to birds via the Bird View. It would be useful for the user to be able to also
                    assign breeding sites from this screen.<br> This functionality wasn't considered for development as
                    the user is already able to assign breeding sites through other means, however it would increase
                    user efficiency / productivity if the task could be achieved via this screen too.
                </li>
            </ul>
            <ul>
                <li><strong>Allow user to view the bird details by clicking on the bird name.</strong><br>The bird names
                    in the 'Occupied by' columns could be clickable and bring up bird details.<br> This functionality
                    wasn't added due to an oversight, as
                    such functionality already exists in similar pages, such as Live View.
                </li>
            </ul>
        </p>
    </div>
    <div id="user">
        <h2>5.10 User Management <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.10.1 Manage Users Screen</h3>
        <img src="Phase5/Img/manageusers-ss.png" class="center"></img>
        <h3>5.10.2 User Privileges</h3>
        <p>
            A user can have the following privileges:
            <ul>
                <li>
                    <strong>Read</strong> - this privilege allows the user to read all non-admin data (birds, visits, nest sites, rings)
                </li>
                <li>
                    <strong>Create</strong> (includes Read) - this privilege allows the user to create non-admin data (birds, visits, nest sites, rings) and edit / delete records that they have created, but not records made by other users
                </li>
                <li>
                    <strong>Edit</strong> (includes Create) - this privilege allows the user to edit / delete all non-admin data (birds, visits, nest sites, rings)
                </li>
                <li>
                    <strong>Export</strong> (includes Read) - this privilege allows the user export bird data to spreadsheet
                </li>
                <li>
                    <strong>Admin</strong> (includes all above) - this privilege allows the user to create, edit, view and delete admin data (user management & user activity monitor)
                </li>
                <li>
                    <strong>Super Admin</strong> - this privilege gives the user the same level of access as Admin. Super Admin users can only be created, updated or deleted via manual database queries. This privilege was added to prevent the possibility of users being locked out of the system in the case that all other user accounts are inaccessible.
                </li>
            </ul>
            Privileges are taken into account when granting access in both front-end and back-end. In the front-end, this is normally handled by using v-show directives
            to control when certain UI elements are rendered. For example, the following button seen in <code>get-bird.ejs</code>:
            <pre><code>
                &lt;button class="btn btn-dark" data-toggle="modal" data-target="#createBirdModal" @click="openCreateBirdModal" v-show="me.hasCreateEdit"&gt;Register
                    New Bird&lt;/button&gt;
            </code></pre>
            will only render if the user has Create privileges (represented as hasCreateEdit flag in the code). In the back-end, this is handled using the
            <code>policies.js</code> file that maps API routes to policies that must pass, or else the user will receive a 403 response.
        </p>
        <h3>5.10.3 Creating Users</h3>
        <img src="Phase5/Img/createuser-ss.png" class="center"></img>
        <p>
            Users are created through a modal form seen in the screenshot above. The following live validation is
            performed on the form to ensure data integrity:
            <ul>
                <li>
                   Username, full name and password must be present and unique
                </li>
                <li>
                    Password must be at least 6 characters and match Confirm Password
                </li>
            </ul>
            If an invalid value is detected, the field is highlited in red and the user isn't allowed to submit the form
            until they enter valid values:
            <div><img src="Phase5/Img/invaliduserform-ss.png" class="center"></img>
            </div>
            If all values are valid, the data is sent to the back-end (<code>create-user.js</code>) where the password is hashed and the
            user
            record is inserted in the database.
        </p>
        <h3>5.10.4 Viewing Users</h3>
        <p>
            The users are displayed in a simple paginated HTML table, following the design of similar pages. The user
            data for the current page is pulled from the back-end (<code>get-user.js</code>) and the table is populated
            using a v-for loop. Filtering
            is available on the user's full name. Filtering is done in the backend and the list of
            matching rings is updated as soon as the user types or edits anything in the filter field.
        </p>
        <h3>5.10.5 Editing Users</h3>
        <p>
            The admin can edit data on any user, except for its username. This is done by clicking on the 'Pencil' icon
            in the Actions column. If the icon can't be displayed, the text 'Edit user' is shown instead. The edit
            screen is the same as the create screen
            seen in 5.10.3, with the exception that non-password fields are pre-poulated with existing data and the 'Username' field is disabled. When the user clicks 'Save', the new data is sent to the back-end
            (<code>edit-user.js</code>)
            and the relevant record updated.<br><br> The admin can delete any users, except for themselves and users with Super Admin privileges. In this case, the nest site will be removed from the bird's record. This is done by
            clicking on the 'Bin' icon in the Actions
            column. If the icon can't be displayed, the text 'Delete user' is shown instead. The user is prompted
            for confirmation and, if they accept, a request is sent to the backend (<code>delete-user.js</code>) to
            delete this nestsite record
            from the database.<br><br>
            When a user is edited or deleted via this screen, their session, if active, is terminated. This is achieved with the following code in
            <code>edit-user.js</code> and <code>delete-user.js</code>:
            <code><pre>
                this.req.sessionStore.all((error, sessions) => {
                    if(sessions) {
                      for (const nextSession of Object.keys(sessions)) {
                        if(sessions[nextSession].userId == inputsWrapper.id) {
                          vm.req.sessionStore.destroy(nextSession, () =>
                           console.log(`Destroyed session for user with ID ${inputsWrapper.id} as their details were changed`))
                        }
                      }
                    }
                  })
            </pre></code>
        </p>
        <h3>5.10.6 Future Improvements</h3>
        <ul>
            <li>
                <strong>More filtering options & more information on users.</strong><br>
                The ability to filter on username and privilege level could be useful and simple from a development perspective. We could also store more information
                about each user - for example, the last time they were active, or the IP address from which they logged on.<br>
                This wasn't added as it wasn't required by the user, however it could be suggested as a possible improvement in the future to improve
                the administration experience and capabilities.
            </li>
        </ul>

    </div>
    <div id="useract">
        <h2>5.11 User Activity Monitoring <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.11.1 User Activity Monitor Screen</h3>
        <img src="Phase5/Img/uam-ss.png" class="center"></img>
        <h3>5.11.2 Viewing User Activity Monitor</h3>
        <p>
            The User Activity Monitor screen, seen in section 5.11.1, shows actions taken by users that modified the
            data in some way. The following actions are logged:
            <ul>
                <li>Create / edit bird</li>
                <li>Create / edit / delete nestsite</li>
                <li>Import / delete RFID ring</li>
                <li>Create / edit / delete user</li>
                <li>Edit your own full name / password</li>
            </ul>
            The logs are displayed in a simple paginated HTML table, following the design of similar pages. The logs for
            the current page is pulled from the back-end (<code>get-changelog.js</code>) and the table is populated
            using a v-for loop.<br>
            Filtering is available on username, date range, action and data (all of these, except for date, are a
            contains-match). Filtering is done in the backend and the list of matching logs is updated as soon as the
            user types or edits anything in any of the filter fields.<br>
            The associated data can be viewed by clicking on the 'eye' icon in the action column (if this icon can't be
            displayed, the text 'View Data' is shown instead).
            The user is then presented with a screen showing the data that was changed:
            <div>
                <img src="Phase5/Img/viewdata-ss.png" class="center"></img>
            </div>
        </p>
        <h3>5.11.3 Logging actions</h3>
        <p>
            Actions are logged using the <code>logActivity</code> function (<code>log-activity.js</code>). The
            controller of the modifying action
            is responsible for the format of the data it passes to this function and adding / excluding any data (such
            as passwords). The <code>logActivity</code> function
            takes four parameters: <code>oldData</code>, <code>newData</code>, <code>action</code> and
            <code>user</code>. It is responsible for removing any data that's
            duplicated in oldData and newData (so only attributes different between the two are stored), converting the
            data from JSON to string, and storing it in the database:
            <pre><code>
        fn: async function (inputs, exits) {
            let newDataDiff = _.diff(inputs.newData, inputs.oldData);
            let oldDataDiff = _.diff(inputs.oldData, inputs.newData);
        
            await Changelog.create({
                user: inputs.userId,
                action: inputs.action,
                newData: JSON.stringify(newDataDiff, null, '\t'),
                oldData: JSON.stringify(oldDataDiff, null, '\t')
            })
            return exits.success();
            }
            </code></pre>
            Some further formatting is done by the frontend before displaying the data, in order to improve readability,
            such as removing curly brackets, extra quotes, inserting line-breaks where required.
        </p>
        <h3>5.11.4 Future improvements</h3>
        <ul>
            <li>
                <strong>Present the data in a more readable format.</strong><br>
                Currently, relatively little formatting is done on the raw data used in the backend. For example, for
                the most part, the
                attribute names are shown how they appear in the database, rather than how they appear in the front-end
                (for example, 'fledgedWhere' instead of 'Where Fledged').
                This would improve readability and make it more user-friendly, as this screen is intended to be used by
                both technical and non-technical users.<br>
                This wasn't done as it would require planning to prevent the codebase from becoming convulated, and it
                was viewed as a relatively insignificant improvement,
                so wasn't prioritised.
            </li>
            <li>
                <strong>Add a scheduled clean-up function.</strong><br>
                As the system is used over years, the database table of logs will grow larger and larger. Currently
                there is no way to delete old data without executing manual
                database queries. This doesn't affect the user experience as they are able to filter the logs by
                date-range (a default date-range filter of a 1-month period is applied).
                However, there is a risk that this table grows too large and starts using up database resources that
                could be better used elsewhere.<br>
                This wasn't done as as pruning of old logs wasn't discussed with the user, so the feature wasn't added
                to avoid introducing unexpected behaviour / causing data loss. Furthermore, it is an issue that is
                highly unlikely to occur within the foreseeable future, and can easily be added at any later time even
                by developers who aren't familiar with the overall system.
            </li>
        </ul>
    </div>
    <div id="over">
        <h2>5.12 Account Overview <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.12.1 Account Overview Screen</h3>
        <img src="Phase5/Img/accountoverview-ss.png" class="center"></img>
        <h3>5.12.2 Viewing Account Overview</h3>
        <p>
            Account Overview is a simple screen that shows the user's full name, username, privileges and registration
            date.
            It also allows the user to update their full name and password.

        </p>
        <h3>5.12.3 Editing Account Details</h3>
        <p>
            The user is able to update their full name and password by using the 'Edit profile' and 'Change password'
            buttons, respectively:
            <div>
                <img src="Phase5/Img/editaccount-ss.png" class="center"></img>
            </div>
            Live validation is done on the password field to ensure that it is at least 6 characters long, and the
            password confirmation matches.
            Live validation is also done on the full name field to ensure that the full name isn't empty. If validation
            fails, the field is highlited in red
            and the user is prevented from saving the form.<br>
            When clicking save, the data is sent to the back-end (<code>update-password.js</code> for password and
            <code>update-profile.js</code> for full name),
            where the relevant database record is then updated with the new data.
        </p>
    </div>
    <div id="utils">
        <h2>5.13 Utilities <a class="bu" href="#">Back to Top </a></h2>
        <h3>5.13.1 Autocomplete - Karlis Jaunslavietis</h3>
        <p>
            <code>autocomplete</code> is a custom Vue component defined in <code>autocomplete.component.js</code>.
            The component is used to aid user input on forms / filters by presenting a drop-down list of possible values,
            obtained from the database. The list is filtered based on current input. It is used in various places throughout the system.
            <div><img src="Phase5/Img/autocomplete-ss.png" class="center"></img></div>
            In the above example, it is used in the Edit Bird screen to present a list of valid NFC rings that can be assigned to the bird.
            The component can be embedded in a form the following way:
            <pre><code>
                &lt;input id="nfcRingIDEdit" type="text"&gt;
                &lt;autocomplete for="nfcRingIDEdit" action="getRfid" params='{"limit": 5}' map="nfcRFID" is-async&gt; &lt;/autocomplete&gt;
            </code></pre>
            The <code>for</code> attribute indicates the ID of the input field that this autocomplete should attach to. This is used for positioning of the autocomplete
            dropdown, reading the current input and populating the input field when an autocomplete result is clicked.<br>
            The <code>action</code> attribute is the Sails action name of the controller that will be used to retrieve the data used for suggestions.<br>
            The <code>params</code> attribute is a JSON-string that should contain any additional parameters passed to the controller.<br>
            The <code>map</code> attribute is a string that, if present, indicates the field key that should be used to populate the autocomplete
            suggestions if a complex object is retreived. For example, if the following object is received from the controller:
            <pre><code>
                {
                    id: 3,
                    nfcRFID: "ah202",
                    nfcRFIDInternal: "AE40233I249221242",
                    birdID: 5
                }
            </code></pre>
            having <code>map="nfcRFID"</code> will mean that only the value of the nfcRFID field ("ah202") will be shown in the suggestions.<br>
            The <code>is-async</code> parameter indicates that the suggestions should be retrieved from the backend asynchronously.
        </p>
        <h3>5.13.2 Concurrency Lock - Karlis Jaunslavietis</h3>
        <p>
            <code>lock</code> is a custom Vue component defined in <code>lock.component.js</code>. The component is used to implement a
            mutual lock mechanism to prevent two users from editing the same data at the same time. It is currently used in the following views:
            <ul>
                <li>
                    Edit Bird
                </li>
                <li>
                    Edit Nestsite
                </li>
                <li>
                    Edit User
                </li>
            </ul>
            It works by sending constant 'pings' to the <code>try-acquire-renew-lock.js</code> controller. When the element is created (added to the DOM),
            it attempts to acquire a lock. If another user already has a lock (lock information is stored in the <code>lock</code> table in the database),
            the controller indicates to the component that it failed to acquire a lock. The component then prevents the user from editing the data, as it has detected
            that another user is already editing the same data. If it, instead, manages to acquire a lock, the user is granted access to edit the data, and the element
            constantly pings the controller to refresh the lock and prevent other users from editing the data. The component can be embedded in a view the following way:
            <code><pre>
                &lt;lock :user="me.id" v-if="isEditMode" :action="'editBird'+currentBird.id" :run-on-failed="exitEditMode"&gt;
            </pre></code>
            The <code>v-if</code> directive ensures that this element is only added to the DOM, and therefore operational, when the user is in edit mode; if the user exits edit mode,
            leaves the page or loses connectivity, the lock expires within 10 seconds and another user can then attempt to acquire it.

            <br>
            The <code>user</code> attribute indicates the user ID who's holding the lock; this is used to identify the user who currently holds a lock on the data:
            <div><img src="Phase5/Img/birdlocked-ss.png" class="center"></img></div>
            <br>
            The <code>action</code> attribute uniquely identifies the data the user is currently editing. This should be consistent for all users
            so that the locking mechanism can correctly identify what data is being edited.<br>
            The <code>run-on-failed</code> attribute identifies the function that should run if the lock isn't acquired successfully;
            normally, this should be a function that exits the editing mode, reloads the page or otherwise prevents the user from continuing.
        </p>
        <h3>5.13.3 DateTime Conversions - Priyesh Patel</h3>
        <p>
            <code>TimeUtils</code> is a service defined in <code>api/services/TimeUtils.js</code>. Sails allows functions that need to be used by multiple controllers to be defined in this services folder and they can then be accessed with <code>FileName.FunctionName();</code>.
<br><br>
            in our database we store all dates as Unix Timestamps, we did this because we wanted to make use of Sails' default functionality of making createdAt and UpdatedAt entries for database entries as we could use these to note things like when a bird was made, when someone made changes, what time visit occurred, etc. Sails uses Unix Timestamps for this so in order to keep the data type consistent throughout the database we too used them, but this meant that we would need ways for them to converted to something more meaningful for a human to read.
        <br><br>
        usage off this service can be seen throughout the system, the following images show the usage in code and the output on screen resulting from it:
        </p>
        <h4>api/controllers/live/live-view.js</h4>
        <p>
            In the code which goes through the output from the database query by each row returned the timestamp is converted to AM/PM time.
        <div><img src="Phase5/Img/VisitTimeLive.png" class="centerTrue"></img></div>
        </p>
        <h4>api/controllers/bird/get-bird.js</h4>
        <p>
            Similarly in bird view the timestamp is take and is converted, but this time into an age string show how old the bird is based on hatch date.
        <div><img src="Phase5/Img/AgeString.png" class="centerTrue"></img></div>
        </p>
        <p>
            It is also used extensively in the export module <code><b>api/controllers/bird/export-data-bird-simple.js</b></code> to perform similar actions to the above and additionally used in dating the file name of the report to avoid a researcher with multiple files with the same name (report, report(1), etc).
        </p>
    </div>


</body>

</html>