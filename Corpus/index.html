<!DOCTYPE html>
<html>

<body>

    <header>
        <title>CO600 Corpus Material</title>
        <h1 id="title">CO600 Corpus Material</h1>


        <link rel="stylesheet" href="main.css">

    </header>
    <div id="navTable">
        <table id="t01" align="center">
            <tr>
                <td>Project title</td>
                <td> EchoBook (Echo Parakeet tracking system in Mauritius)</td>
            </tr>
            <tr>
                <td>Group members</td>
                <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem, Elina Voitane</td>
            </tr>
            <tr>
                <td>Supervisor</td>
                <td>Daniel Knox</td>
            </tr>

        </table>
        <br>

        <table id="t02" align="center">

            <tr>
                <th>No.</th>
                <th>Document title</th>
                <th>Author(s)</th>
                <th>Best Work</th>
            </tr>

            <tr>
                <th colspan="4"> Phase 1 Research</th>
            </tr>

            <tr>
                <td> 1.1 </td>
                <td><a href="#wirelesstechnologies"> Wireless Technologies</a></td>
                <td> Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>

            <tr>
                <td> 1.2 </td>
                <td><a href="#hardwarelist"> Hardware List</a></td>
                <td> Karlis Jaunslaietis </td>
                <td></td>
            </tr>
<tr>
                <td> 1.3 </td>
                <td><a href="#software"> Software List</a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 2 Requirements </th>
            </tr>

            <tr>
                <td> 2.1 </td>
                <td><a href="#users"> Understanding the user </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>
            <tr>
                <td> 2.2 </td>
                <td><a href="#stories"> User Stories </a></td>
                <td> Karlis Jaunslavietis, Elina Voitane, Priyesh Patel, Afzaal Ahmad Razeem</td>
                <td></td>
            </tr>
			<tr>
                <td> 2.3 </td>
                <td><a href="#usecases"> Use Case Diagrams </a></td>
                <td> Karlis Jaunslavietis, Elina Voitane, Priyesh Patel, Afzaal Ahmad Razeem</td>
                <td></td>
            </tr>
            <tr>
                <td> 2.4 </td>
                <td><a href="#reqdoc"> Requirements Document </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <th colspan="4"> Phase 3 System Design </th>
            </tr>
            <tr>
                <td> 3.1 </td>
                <td><a href="#datadi"> Database Diagram </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 3.2 </td>
                <td><a href="#netdi"> Network Diagram </a></td>
                <td> UNKNOWN </td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 4 UI Design </th>
            </tr>

            <tr>
                <td> 4.1 </td>
                <td><a href="#lofi1"> Lo-Fi Design 1 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>


            <tr>
                <td> 4.2 </td>
                <td><a href="#lofi2"> Lo-Fi Design 2 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <td> 4.3 </td>
                <td><a href="#hifi1"> Hi-Fi Design 1 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <td> 4.4 </td>
                <td><a href="#hifi2"> Hi-Fi Design 2 </a></td>
                <td> Elina Voitane </td>
                <td></td>
            </tr>

            <tr>
                <th colspan="4"> Phase 5 Development </th>
            </tr>
            <tr>
                <td colspan="4"> Development did not follow an ordered structure as the above phases (components were started, "finished" and updated throughout as expected in a user-centred system), so instead this section will just be split by system components. In
                    cases of components being worked on by multiple people, the actual work contributed by each member will be discussed in it's section.
                </td>
            </tr>
            <tr>
                <td> 5.1 </td>
                <td><a href="#scripts">Coordinator Service</a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.2 </td>
                <td><a href="#datamodel"> Database / Models </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.3 </td>
                <td><a href="#css"> CSS Styling & Matching UI Design </a></td>
                <td> Priyesh Patel, Afzaal Ahmad Razeem, Karlis Jaunslavietis</td>
                <td></td>
            </tr>
            <tr>
                <td> 5.4 </td>
                <td><a href="#log"> Login/Logout </a></td>
                <td> Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.5 </td>
                <td><a href="#live"> Live View </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.6 </td>
                <td><a href="#bird"> Bird View </a></td>
                <td> Afzaal Ahmad Razeem / Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.7 </td>
                <td><a href="#export"> Bird Data Export </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.8 </td>
                <td><a href="#ring"> Ring Management </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.9 </td>
                <td><a href="#nest"> Nest Management </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.10 </td>
                <td><a href="#user"> User Management </a></td>
                <td> Karlis Jaunslavietis / Afzaal Ahmad Razeem </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.11 </td>
                <td><a href="#useract"> User Activity Management </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.12 </td>
                <td><a href="#over"> Account Overview </a></td>
                <td> Karlis Jaunslavietis </td>
                <td></td>
            </tr>
            <tr>
                <td> 5.13 </td>
                <td><a href="#utils"> Utilities </a></td>
                <td> Karlis Jaunslavietis / Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <th colspan="4"> Phase 6 Development Documentation </th>
            </tr>
            <tr>
                <td> 6.1 </td>
                <td><a href="#sysdi"> System Diagram </a></td>
                <td> Priyesh Patel </td>
                <td></td>
            </tr>
            <tr>
                <td> 6.2 </td>
                <td><a href="#useman"> User Manual </a></td>
                <td> UNKNOWN </td>
                <td></td>
            </tr>
            <th colspan="4"> Module Deliverables </th>
            </tr>
            <tr>
                <tr>
                    <td>D1</td>
                    <td><a href="#"> Abstract </a></td>
                    <td>Elina Voitane</td>
                    <td></td>
                </tr>
                <tr>
                    <td>D2</td>
                    <td><a href="ModuleDeliverables/PosterFinal.pdf"> Poster </a></td>
                    <td>Elina Voitane</td>
                    <td></td>
                </tr>
                <tr>
                    <td>D3</td>
                    <td> <a href="#">Technical Report</a></td>
                    <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem, Elina Voitane</td>
                    <td></td>
                </tr>
                <tr>
                    <td>D4</td>
                    <td><a href="#">Source Code</a> </td>
                    <td>Karlis Jaunslavietis, Priyesh Patel, Afzaal Ahmad Razeem</td>
                    <td></td>
                </tr>
                <tr>
                    <td>D5</td>
                    <td><a href="#">System Video</a> </td>
                    <td>Elina Voitane, Priyesh Patel, Afzaal Ahmad Razeem, Karlis Jaunslavietis,</td>
                    <td></td>
                </tr>
                <tr>
                    <th colspan="4"> Miscellaneous </th>
                </tr>
                <tr>
                    <td>M1</td>
                    <td><a href="Miscellaneous/Meeting%20Minutes%20Combined.pdf"> Meeting Minutes </a></td>
                    <td>Elina Voitane</td>
                    <td></td>
                </tr>
                <tr>
                    <td>M2</td>
                    <td><a href="Miscellaneous/Project%20Plan.pdf"> Project Plan </a></td>
                    <td>Elina Voitane</td>
                    <td></td>
                </tr>
                <tr>
                    <td>M3</td>
                    <td><a href="#"> Risk Assessment </a></td>
                    <td>Elina Voitane</td>
                    <td></td>
                </tr>
        </table>
    </div>

    <div id="wirelesstechnologies">
        <h2 id="wirelesstechnologies"> Wireless Technologies <button><a href="#title">Back to Top </a></button></h2>

        <table id="t03" align="center">

            <tr>
                <td>BLE (Bluetooth Low Energy)</td>
                <td>ZigBee</td>
                <td>LoraWAN (Long range Area wide network)</td>
            </tr>

            <tr>
                <td id="tableinfo">
                    <ul>
                        <li>BLE is low power</li>
                        <li>It is cheap</li>
                        <li>Data rate is 1mb/s</li>
                        <li>Range 50-150 metres</li>
                        <li>BLE does not officially offer mesh network*</li>
                    </ul>

                    <p>* Few BLE solutions do offer mesh network (Nordic, Qualcomm)</p>
                    <br>
                    <p>BLE supported hardware on Mbed</p>
                    <ul>
                        <li>Nordic development board</li>
                        <li>Seeed Arch BLE</li>
                    </ul>
                </td>

                <td id="tableinfo">
                    <ul>
                        <li>Used in mesh network designed to carry small amounts of data across medium distances</li>
                        <li>Low power (more than BLE)</li>
                        <li>Data rate is 250 kb/s</li>
                        <li>Range 10-100 metres</li>
                        <li>Official Mbed library</li>
                    </ul>
                </td>

                <td id="tableinfo">
                    <ul>
                        <li>Data rate is 0.3 - 50 kb/s</li>
                        <li>Range 2-3km (urban environment)</li>
                        <li>Power consumption lower than ZigBee</li>

                    </ul>
                </td>

            </tr>

        </table>
        <br>
        <h3> Conclusion</h3>
        <p>BLE is a radio protocol meant for PAN. Good for devices that stay in close proximity to each other. It is not ideal for devices that are separated by more than a few meters away from each other. Zigbee is a better option for our needs. Considering
            ZigBee's almost instant network join time it is more suitable for our project needs as well as its support for large-scale automation purposes. The trade-off that had to be considered was ZigBee's higher power consumption than BLE, however,
            given our project scenario, this trade-off can be afforded.
        </p>
    </div>
    <div id="hardwarelist">
        <h2 id="hardwarelist"> Hardware List <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="software">
        <h2 > Software List <button><a href="#title">Back to Top </a></button></h2>
</div>
	<div id="users">
        <h2> Understanding the user <button><a href="#title">Back to Top </a></button></h2>

        <p>One of the first challenges when working on requirements from the client was to understand users of the system, what they are responsible for when working on field and how much access they are allowed to scientifically important data</p>
        <p>As per conversation with the client there will be 3 types of system users:</p>
        <ul>
            <li>Field staff-Input Data, but not export</li>
            <li>Coordinators-Input data and export reports</li>
            <li>Higher Level Staff-Export Basic reports but not input or edit data</li>
        </ul>

        <h3>Interaction with client</h3>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase2/understandusers.png" width="350" height="500"></td>
            </tr>
        </table>
        <p>Based on answers from client it was decided to build system that work on principle of least privilege (POLP). Instead of assigning each user to particular role, each user will be granted with list of privileges based on their role. </p>
        <p>List of privileges:</p>
        <ul>
            <li>Read (Can only view data)</li>
            <li>Create (Can add new data into system)</li>
            <li>Edit (Can modify existing information)</li>
            <li>Export (Can export reports)</li>
            <li>Admin (Has all of the above)</li>
        </ul>

        <p>In addition, Admins are able to register new users, assign privileges, modify users and delete users. Admins can delete other Admins which is needed in case people are no longer working on the research.
        </p>
    </div>
    <div id="stories">
        <h2> User Stories <button><a href="#title">Back to Top </a></button></h2>

        <p> To get better understanding of user requirements and system functionality we have written users stories to describe different features of the system.</p>
        <h3> System Setup</h3>
        <ol>
            <li>As a researcher, I can attach a tag to a bird and keep track of the tag ID, enabling me to register the bird in the system.</li>
            <li>As a technician, I can setup the network linking feeders and the central hub. This allows me to install hardware and software components of the system from scratch.</li>
        </ol>
        <h3>System Usability</h3>
        <ol>
            <li>As a user, I can log into the system using my username and password</li>
            <li>As a user, I can log out of the system locking my account. For the system to be used again, the next user needs to enter their own username / password.</li>
            <li>As a user with privileges to add information into the system, I can register a tagged bird in the system. This allows the system to track the bird visits to feeders and store this data into database.</li>
            <li>As a user with privileges to edit data, I can edit data about a bird registered in the system to update a bird's details (such as status, condition etc.).</li>
            <li>As a user with privileges to view data, I can view any data held about birds.</li>
            <li>As a user with privileges to export data, I can filter the report before viewing/exporting it so that it shows only fields I am interested in. This allows me to narrow down the dataset to only relevant subjects.</li>
            <li>As a user with admin privileges, I can register a new user and assign them with appropriate privileges. This ensures that each user of the system has the minimal amount of access required to carry out their duties without compromising additional
                functionality of the system.</li>
            <li>As a user with view privileges I want to see the most relevant data about birds first such as: Individual ID, Name, Sex, Male parent, Female parent, Age, Breeder or Non-Breeder, Nest site from the previous breeding season, Nest site distance
                to hopper.
            </li>
        </ol>
        <h3>System Maintenance</h3>
        <ol>
            <li>As a technician, I can update the system with a patch issued by the development team. This allows me to keep the system up-to-date and prevent software bugs and vulnerabilities from hampering normal operation.</li>
            <li>As a user with any type of privileges, I am notified if any part of the system is suspected to be non-functional (such as a broken communications link). This allows me to detect errors faster and recover while minimizing data loss.</li>
            <li>As user with any type of privileges, I can restart any part the system after a power / other failure to return it to an operational state.</li>
        </ol>

        <h3>New User stories based on interaction with the client</h3>
        <ol>
            <li>As a user with admin privileges, I can view a log of significant actions taken by other users of the system, such as registering a bird, connecting a feeder etc. This helps me troubleshoot and identify errors made by other team members, as
                well as to detect any unusual activity.</li>
            <li>As a user with any type of privileges I want to add list of new unassigned rings to the system.</li>
            <li>As a user with any type of privileges I want to keep track of assigned and unassigned rings.</li>
        </ol>
    </div>
    <div id="usecases">
        <h2> Use Case Diagrams <button><a href="#title">Back to Top </a></button></h2>
    </div>
	<div id="reqdoc">
        <h2> Requirements Document <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="datadi">
        <h2> Database Diagram <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="netdi">
        <h2> Network Diagram <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="lofi1">
        <h2> Lo-Fi Design 1 <button><a href="#title">Back to Top </a></button></h2>
        <p>The first version of Lo-Fi prototype was created using myBalsamiq tool. The idea of the first prototype was to decide on basic layout for buttons and how data will be displayed on the screen. </p>
        <p> First list of requirements listed by client includes:</p>
        <ul>
            <li>Register new birds</li>
            <li>Register new nest sites</li>
            <li>View database with all bird data</li>
            <li>Create reports</li>
            <li>Search information</li>
            <li>Live View (This functionality was proposed by us and it was approved by client as it would be useful for researchers to see which birds and how often are visiting feeders.)</li>
        </ul>


        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Home Screen </td>
                <td id="img"> Live View </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/lofihomescreen.png" width="400" height="200"></td>
                <td id='img'><img src="Phase3/lofiliveview.png" width="400" height="200"></td>
            </tr>

            <tr>
                <td id="img"> Admin page </td>
                <td id="img"> Register New User Page </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/lofiadminpage.png" width="400" height="200"></td>
                <td id='img'><img src="Phase3/lofiregnewuser.png" width="400" height="200"></td>
            </tr>
        </table>
    </div>
    <div id="lofi2">
        <h2> Lo-Fi Design 2 <button><a href="#title">Back to Top </a></button></h2>

        <p>Second version of Lo-Fi prototype and all the following versions were created using Google Slides. In second version we have changed layout of the home screen and decided to locate all menu options to the left side as it allows users to navigate
            through the application without going back to main menu screen. Version 2 of Lo-Fi design shows 2 different options of Live View. First option displays all data entries in a large table. This view does not include filters and pagination and
            hence is not user friendly especially when dealing with large amounts of data. In second version we have added filters and pagination. This will enable users to easily navigate through large amounts of data, search for information using search
            bar at the top and pick specific bird visit times using time filter.</p>
        <br>
        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Live View Version 1 </td>
                <td id="img"> Live View Version 2 - (Priyesh Patel)</td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/lofiliveview2.png" width="400" height="200"></td>
                <td id='img'><img src="Phase3/lofiliveview3.png" width="400" height="200"></td>
            </tr>
        </table>
        <br>
    </div>
    <div id="hifi1">
        <h2> Hi-Fi Design 1 <button><a href="#title">Back to Top </a></button></h2>
        <p> This version of UI design was created once we decided that for system development, we will be using sails.js web application framework which supports large number of user-friendly UI features. The priority was to concentrate on displaying data
            in Live View, in Single Bird View and Bird Table view. Based on this, other parts of the system can be constructed in the same way to create consistent UI throughout the whole system.</p>
        <h3> Live View</h3>
        <p>In order to display as much information as possible we decided to locate drop-down menu at the top of the page in the left corner which freed up the space to display more information on the screen. More sophisticated time filters were added in
            order to find specific bird visit times. Users can search for birds by typing their name in the search box. Pagination bar in the footer enables users to navigate through large amount of data more easily. If users wanted to view full information
            about bird that showed up on the live view they can press 'View' button at the end of the row and it would open new view with bird information.
        </p>
        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Live View Version 3 </td>
                <td id="img"> Live View Version 3 with Menu </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/hifiliveview1.png" width="400" height="200"></td>
                <td id="img"><img src="Phase3/hifiliveview2.png" width="400" height="200"></td>
            </tr>
        </table>

        <p>This version of 'Live View' has been modified number of times. Table has been moved to centre. First column has been removed to avoid unnecessary information on the screen as it does not serve any purpose for researchers. Menu has been moved to
            the top right corner and 'Live View' button has been added so that users can always return to live screen from any view. 'View' button at the end of each row has been also removed as we decided that this option can be replaced with different
            functionality such as pressing on the table entry. This made Live View less cluttered from unnecessary buttons. </p>

        <p>We also had to decide on the ways of showing users when visits have been registered in the system. If new visits were added automatically, it would distract users from viewing Live View, therefore system was developed in the way that it would
            inform users that new visits were registered and advice users to refresh the page.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Live View Version 4</td>
                <td id="img"> Live View Version 4 with Menu </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/liveview4.png" width="400" height="200"></td>
                <td id="img"><img src="Phase3/liveview4menu.png" width="400" height="200"></td>
            </tr>
        </table>


        <h3> Single Bird View</h3>
        <p>One of the ways to view single bird information is by clicking on 'View' button from Live View screen. All data is aligned to centre and buttons are added to expand more information about birds such as: Parent information, More information and
            table with past visits. 'Edit' button in the footer allows to edit information in this view.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Bird View </td>
                <td id="img"> Bird View Edit Mode </td>
            </tr>
            <tr>
                <td id="img"><img src="Phase3/birdview.png" width="400" height="200"></td>
                <td id="img"><img src="Phase3/birdviewedit.png" width="400" height="200"></td>
            </tr>
        </table>


        <p>Single Bird view has also been modified. Instead of arranging all data in one column, decision has been made to display information in two columns. This enables users to see more data on the screen. 'Export' button has been added in the footer
            to export information about one bird as requested by the client, however this function has been removed at the later stage after user testing as researcher advised that this function will not be used. </p>



        <table id="lofitable1" border="0">
            <tr>
                <td id="img"> Bird View Version 2</td>
                <td id="img"> Bird View Edit Mode Version 2 </td>
            </tr>

            <tr>
                <td id="img"><img src="Phase3/birdview2.2.png" width="400" height="200"></td>
                <td id="img"><img src="Phase3/birdviewedit2.png" width="400" height="200"></td>
            </tr>
        </table>
        <table>
            <tr>
                <td id="img"><img src="Phase3/birdviewdecision.png" width="400" height="175"></td>
            </tr>
        </table>
    </div>
    <div id="hifi2">
        <h2> Hi-Fi Design 2 <button><a href="#title">Back to Top </a></button></h2>

        <h3>Contrast checker</h3>
        <p>Following first UI prototype test, client agreed to chosen colour scheme for the system. However, chosen colours failed contrast checker criteria.</p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase3/contrastfail.png" width="350" height="200"></td>
            </tr>
        </table>

        <p>To meet usability standard, colours had to be modified. As client already agreed to chosen colours scheme, we decided to use same colours, but modify shades and brightness. Pictures below show that new colours have passed the contrast checker
            criteria.
        </p>

        <table id="lofitable1" border="0">
            <tr>
                <td id="img"><img src="Phase3/contrastpass1.png" width="350" height="200"></td>
                <td id="img"><img src="Phase3/contrastpass2.png" width="350" height="200"></td>
            </tr>
        </table>

    </div>
    <div id="scripts">
        <h2>5.1 Coordinator Service<button><a href="#title">Back to Top </a></button></h2>
        <h3>5.1.1 High Level Activity Diagram</h3>
        <img src="Phase5/Img/Python_HighLevel.svg" class="center"></img>
        <!-- TODO:
            1. give example of RFID packet
            2. more info on config validation
            3. link pictures to text and make images stand out more
            4. use diagrams more than text (state / flow)
            5. future improvements is a go, make sure technical purpose is outlined and why they weren't included -->
        <h3>5.1.2 Config</h3>
        <p>
            Configuration parameters are defined in <a href="Phase5/Src/config.py" target="_blank"><code>config.py</code> (follow link to see an example with comments)</a>.
            Parameters
            are validated in two steps - static (explicit) and dynamic (implicit). In the static step, the following conditions must be met:
            <ul>
                <li>
                    <code>config.py</code> exists
                </li>
                <li>
                    Required parameters defined (<code>db_host</code>, <code>db_user</code>, <code>db_password</code>, <code>db_port</code>, <code>db_name</code>)
                </li>
            </ul>
            Parameters related to the database are the only required values as the service can't make reasonable default guesses. 
            The static step also internally sets the default values where applicable. If one of the conditions above is not satisfied, the service exits with a descriptive error message
            (eg. <code>"Missing required config param db_name"</code>). If a default value is used, the service outputs a log informing the user (eg. <code>"Mising optional config param log_level, using default = 'WARNING'"</code>,
            or <code>"Unknown log_level value TRACE in config, must be one of 'DEBUG' | 'INFO' | 'WARNING' | 'ERROR' | 'CRITICAL'. Using default = 'WARNING'"</code>).<br><br>
            The dynamic step occurs when the service attempts to use the provided parameters to connect to the database and serial port. If either of the connections fail, the service exits with
            an error message informing the user what went wrong (eg. <code>"Couldn't connect to database, make sure it's running and the correct connection params are set in config.py"</code>).
        </p>
        <h3>5.1.3 Reading RFID packets</h3>
        <p>
            The RFID packets are 13 bytes long and have the following structure:
            <table>
                <tr>
                    <th>Start byte (static - 1 byte)</th>
                    <th>Unused (static - 3 bytes)</th>
                    <th>Tag Data (varies - 7 bytes)</th>
                    <th>XOR checksum (varies - 1 byte)</th>
                    <th>End Byte (static - 1 byte)</th>
                </tr>
                <tr>
                    <td>
                        <code>0xAA</code>
                    </td>
                    <td>
                        <code>0x0F 0x08 0x00</code>
                    </td>
                    <td>
                        <code>0x03 0x84 0x12 0xDB 0xFA 0xE7 0xD5</code>
                    </td>
                    <td>
                        <code>0xB1</code>
                    </td>
                    <td>
                        <code>0xBB</code>
                    </td>
                </tr>
            </table>
            Testing showed that packets are not separated from one another in the incoming serial data stream. Therefore, a mechanism was required to deal with the possibility that a network
            error causes us to receive a packet with missing, or extra, bytes. Simply relying on start and end bytes would not be sufficient, as the tag data can also contain <code>0xAA</code> and <code>0xBB</code>.
            Therefore, the code builds up a buffer that always starts with <code>0xAA</code>, is at least 13 bytes long, and always ends with <code>0xBB</code>. This increases the chance that the buffer will contain
            a valid packet and minimizes data loss by allowing for some network noise before or after the packet. This is achieved with the following code:
            <pre><code>
                    buffer = bytearray()
                    while True:
                        read = self.ser.read(1)[0] # read one byte at a time
            
                        if read == 0xBB and len(buffer) >= 12:
                            # we've read the end byte and the buffer is at least as big as the expected packet size,
                            # so parse what we have (async)
                            buffer.append(read)
                            threading.Thread(target=self.__handle_read, args=(buffer,datetime.datetime.now())).start()
                            buffer = bytearray()
                        elif len(buffer) == 0 and read != 0xAA:
                            # the buffer is empty but we've read something other than the start byte, so let's discard this
                            logging.debug("Read byte %X but expecting start byte 0xAA, discarding this read", read)
                        else:
                            buffer.append(read)
            </code></pre>
            The buffer is then handled asynchronously (described in section 5.1.4) to prevent blocking new incoming data.
        </p>
        <h3>5.1.4 Buffer handling</h3>
            <p>
                The raw buffer is handled by a function that attempts to extract a 13-byte packet that starts with the
                start byte and ends with the end byte, as well as passes XOR checksum validation. If no valid packet is found, the buffer is discarded.
                This is achieved with the following code:
                <pre><code>
                        # tries to extract a single packet from the raw data we received
                        # the raw data should have at most one packet of length 13, starting with 0xAA and ending with 0xBB
                        # if no valid packet found in the data, return None
                        def __try_extract_and_validate_packet(self, incoming_bytes):
                            if len(incoming_bytes) < 13:
                                return None # this shouldn't ever happen
                            else:
                                logging.debug("Received a data buffer with 13 or more bytes, attempting to extract packet")
                                start_index = 0
                                end_index = 12

                                while end_index < len(incoming_bytes):
                                    start_byte = incoming_bytes[start_index]
                                    end_byte = incoming_bytes[end_index]

                                    if start_byte == 0xAA and end_byte == 0xBB:
                                        supposed_packet = incoming_bytes[start_index:end_index+1]
                                        logging.debug("Extracted something that looks like a packet: %s, validating...",
                                            supposed_packet.hex())
                                        if(self.__validate_packet(supposed_packet)):
                                            logging.debug("Validation succeeded, we've found a packet in our data")
                                            return supposed_packet
                                        else:
                                            logging.debug("Validation failed, continuing search for packet")

                                    start_index += 1
                                    end_index += 1 
                                    # if we've reached this point, we either didn't manage to extract a packet,
                                    # or it failed validation, so keep searching

                                return None 
                                # if we've reached this point, our loop failed to extract a valid packet,
                                # so signal to the caller that we've failed by returning None
                </code></pre>
                If a valid packet is found, it (along the date and time the buffer was received) is then passed to the database service, described in section 5.1.5.
            </p>
        <h3>5.1.5 Packet Handling</h3>
        <p>
                The service retrieves the relevant RFID record from the database
                according to the payload of the packet (if no RFID records are found, the packet is discarded). It then checks whether there have been any visits recorded from this RFID record within the period defined by
                same_visit_frequency_minutes setting in the config file. If there are, the packet is discarded. If not, a new record is written in the visit table in the database, containing the date/time the
                buffer was received, the RFID record ID and the bird record ID (if present). The visit table is read directly by the main application to detect and show new visits.
                If at any point the connection to the database is dropped, the service attempts to reconnect up to five times before giving up and exiting with an error message.
        </p>
        <h3>5.1.6 Future Improvements</h3>
        <p>
            <ul>
                <li>
                    <strong>Automatic serial port scanning.</strong><br> Currently, the person launching the service must specify the serial port name in the configuration file. Although the service
                    is intended to be used only by technical users, this can still present a challenge if the user is unfamiliar with the operating system or serial communication in general.<br>
                    This wasn't included due to extensive testing required to ensure that the automatic scanning is reliable and does not introduce more problems that it solves.
                </li>
                <li>
                    <strong>Abstraction of the database layer.</strong><br> Currently, raw SQL queries are used by the service to interact with the database. This presents possible maintenance difficulties
                    in the future as small errors can lead to catastrophic consequences, and code readability is compromised. Object-relational mapping (ORM), similar to the one used for the main system, could be used instead.<br>
                    This wasn't included due to an aim to keep the service lean and reduce level of bloat. However, the right ORM implemented correctly could offset these negatives with the positives it brings.
                </li>
                <li>
                    <strong>Support of API mode.</strong><br> Currently, the service can only read data received in XBee AT mode (AT and API modes compared in section 1.2). API mode support could be added
                    as it allows for greater extensibility and more features, such as identifying when a network device has gone offline.<br>
                    This wasn't included due to the increased complexity of API mode and the system requirements lacking features that could make use of API mode.
                </li>
            </ul>
        </p>
            
    </div>
    <div id="datamodel">
        <h2> Database & Models <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="css">
        <h2> CSS Styling & Matching UI Design <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="log">
        <h2> Login / Logout <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="live">
        <h2> Live View <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="bird">
        <h2> Bird View <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="export">
        <h2> Bird Data Export <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="ring">
        <h2> Ring Management <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="nest">
        <h2> Nest Management <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="user">
        <h2> User Management <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="useract">
        <h2> User Activity Management <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="over">
        <h2> Account Overview <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="utils">
        <h2> Utilities <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="sysdi">
        <h2> System Diagram <button><a href="#title">Back to Top </a></button></h2>
    </div>
    <div id="useman">
        <h2> User Manual <button><a href="#title">Back to Top </a></button></h2>
    </div>


</body>

</html>